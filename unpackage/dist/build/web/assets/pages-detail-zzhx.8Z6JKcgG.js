import{u as a,W as l,R as e,r as t,l as s,c,w as u,E as o,i as n,o as i,b as f,d,x as r,v,q as _,t as m,F as p,J as b,K as k,X as y,Q as g,y as h,S as w}from"./index-DszEigh-.js";import{o as C}from"./uni-app.es.yxr7YjqI.js";import{c as x,a as N,d as j,P as A,C as D,b as T,A as R}from"./uni-popup.C2LCYpza.js";import{h as I}from"./request.CCTae_dV.js";import{u as q,a as E,d as O,b as P,c as B,I as U}from"./attachmentList.DtrauFz4.js";import{u as F}from"./useDetailCommon.B9s0ALLq.js";import{_ as H}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-nav-bar.CQxrnHAm.js";import"./uni-icons.Bqff-X7n.js";import"./uni-easyinput.BqZ0_ocZ.js";const L=H({__name:"zzhx",setup(H){let L;a((a=>({"22e8c284":o(Y)})));let z=null;C((()=>{var a,e,t;L=null==(t=null==(e=null==(a=l())?void 0:a.proxy)?void 0:e.getOpenerEventChannel)?void 0:t.call(e),z=a=>{M.value=a.type,S.value=a.order,da(),na()},L.on("open-detail",z)})),e((()=>{L&&z&&L.off("open-detail",z),z=null}));const M=t(""),S=t({}),$=t({}),G=t([]),J=t([]),K=s((()=>{var a,l;if(!(null==(a=null==$?void 0:$.value)?void 0:a.claimCategoryId))return!1;return!["H0011503","H0011504"].includes(null==(l=$.value)?void 0:l.claimCategoryId)})),{urlParams:Q,wfstatusText:W,setOptions:X,getOptions:V}=F({itemDetail:S,currentType:M,itemDatas:$}),{listHeight:Y}=q({headerSelector:".header-stickt",iosFit:!0}),{inputDialogRef:Z,inputDialogRequired:aa,inputDialogTitle:la,inputDialogPlaceholder:ea,handleInputConfirm:ta,handleInputCancel:sa,onReject:ca,onApprove:ua,approvalRecordList:oa,getApprovalRecord:na}=E({itemDetail:S,currentType:M,successMessage:"已审批",autoGoBack:!0,autoRefresh:!0}),ia=t([{label:"申请人",value:"",key:"applicantName"},{label:"核销部门",value:"",key:"businessUnitName"}]),fa=t([{label:"对应暂支单",value:"",key:"requestFormNos"},{label:"预算栏目",value:"",key:"claimCategoryName"},{label:"暂支金额",value:"",key:"originalAdvancePaymentAmount"},{label:"未结暂支金额",value:"",key:"remainAdvancePaymentAmount"},{label:"核销金额",value:"",key:"writeOffAmount"},{label:"核销内容",value:"",key:"content"}]),da=()=>{I.get(x[M.value],Q.value).then((a=>{var l;let e=(null==(l=a.data)?void 0:l.data)||{};$.value=e||{},ia.value.forEach((a=>{a.value="number"==typeof $.value[a.key]?N($.value[a.key]):$.value[a.key]||""})),fa.value.forEach((a=>{a.value="number"==typeof $.value[a.key]?N($.value[a.key]):$.value[a.key]||""})),$.value.submittedDate&&G.value.push(j($.value.submittedDate));let t=(e.attachmentList||[]).map((a=>({fileTagName:a.fileTagName,fileName:a.fileName,fileUrl:a.fileUrl,id:a.attachmentId})));J.value=[{fileTagName:"发票",children:[]},{fileTagName:"其他",children:[]}];const s=new Map;J.value.forEach((a=>{s.set(a.fileTagName,a)})),t.forEach((a=>{const l=s.get(a.fileTagName);l&&l.children.push(a)}))}))};return(a,l)=>{const e=n,t=h,s=w;return i(),c(e,{class:"detail-page"},{default:u((()=>[f(e,{class:"header-stickt"},{default:u((()=>[f(O),f(e,{class:"hero-card"},{default:u((()=>[f(e,{class:"hero-header"},{default:u((()=>[f(e,{class:"project-name"},{default:u((()=>[f(e,{class:"project-name-1"},{default:u((()=>[d(r(S.value.taskName||"暂支核销单申请"),1)])),_:1}),f(e,{class:"project-name-1"},{default:u((()=>[d(r($.value.businessUnitName),1)])),_:1})])),_:1}),f(e,{class:"amount-box"},{default:u((()=>[f(e,{class:"amount-label"},{default:u((()=>[d("申请核销金额")])),_:1}),f(e,{class:"amount-value"},{default:u((()=>[f(t,{class:"amount-value-symbol"},{default:u((()=>[d("¥")])),_:1}),f(t,{class:"amount-value-number"},{default:u((()=>[d(r(o(N)($.value.writeOffAmount)),1)])),_:1})])),_:1})])),_:1})])),_:1}),f(e,{class:v(["hero-tags",{"hero-tags-width":"pending"!=M.value}])},{default:u((()=>[(i(!0),_(p,null,m(G.value,((a,l)=>(i(),c(e,{class:"tag",key:`tag-${l}-${a}`},{default:u((()=>[d(r(a),1)])),_:2},1024)))),128))])),_:1},8,["class"]),b(f(e,{class:"hero-actions"},{default:u((()=>[f(e,{class:"btn outline",onClick:o(ca)},{default:u((()=>[d("打回")])),_:1},8,["onClick"]),f(e,{class:"btn primary",onClick:o(ua)},{default:u((()=>[d("通过")])),_:1},8,["onClick"])])),_:1},512),[[k,"pending"===M.value]]),b(f(e,{class:"wfstatus-actions"},{default:u((()=>[d(r(o(W)),1)])),_:1},512),[[k,"completed"===M.value&&("Running"==$.value.wfstatus||"Completed"==$.value.wfstatus)]])])),_:1})])),_:1}),f(s,{"scroll-y":"true",class:"scroller"},{default:u((()=>[f(e,{class:"section"},{default:u((()=>[f(e,{class:"section-title"},{default:u((()=>[f(t,{class:"section-title-vertical"}),f(t,{class:"section-title-text"},{default:u((()=>[d("基本信息")])),_:1})])),_:1}),f(e,{class:"info-list"},{default:u((()=>[(i(!0),_(p,null,m(ia.value,((a,l)=>(i(),c(e,{class:"info-item",key:l},{default:u((()=>[f(t,{class:"info-label"},{default:u((()=>[d(r(a.label),1)])),_:2},1024),f(t,{class:"info-value"},{default:u((()=>[d(r(a.value||"--"),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1}),f(e,{class:"section"},{default:u((()=>[f(e,{class:"section-title-2",onClick:l[0]||(l[0]=a=>o(X)(o(A)))},{default:u((()=>[f(e,{class:"section-title-2-left"},{default:u((()=>[f(t,{class:"section-title-vertical"}),f(t,{class:"section-title-text"},{default:u((()=>[d("暂支内容")])),_:1})])),_:1}),f(e,{class:v(["section-title-2-right",{active:o(V)(o(A))}])},null,8,["class"])])),_:1}),f(y,{name:"collapse"},{default:u((()=>[o(V)(o(A))?(i(),c(e,{key:0,class:"account-info-section"},{default:u((()=>[f(e,{class:"account-card"},{default:u((()=>[f(e,{class:"account-info-block"},{default:u((()=>[f(e,{class:"account-info-row"},{default:u((()=>[f(t,{class:"account-info-label"},{default:u((()=>[d(r(fa.value[0].label),1)])),_:1}),f(t,{class:"account-info-value"},{default:u((()=>[d(r(fa.value[0].value||"--"),1)])),_:1})])),_:1})])),_:1}),f(e,{class:"account-info-block",style:{"margin-top":"20rpx"}},{default:u((()=>[f(e,{class:"account-info-row"},{default:u((()=>[f(t,{class:"account-info-label"},{default:u((()=>[d(r(fa.value[1].label),1)])),_:1}),f(t,{class:"account-info-value"},{default:u((()=>[d(r(fa.value[1].value||"--"),1)])),_:1})])),_:1}),f(e,{class:"account-info-row"},{default:u((()=>[f(t,{class:"account-info-label"},{default:u((()=>[d(r(fa.value[2].label),1)])),_:1}),f(t,{class:"account-info-value"},{default:u((()=>[d(r(fa.value[2].value||"--"),1)])),_:1})])),_:1}),f(e,{class:"account-info-row"},{default:u((()=>[f(t,{class:"account-info-label"},{default:u((()=>[d(r(fa.value[3].label),1)])),_:1}),f(t,{class:"account-info-value"},{default:u((()=>[d(r(fa.value[3].value||"--"),1)])),_:1})])),_:1}),f(e,{class:"account-info-row"},{default:u((()=>[f(t,{class:"account-info-label"},{default:u((()=>[d(r(fa.value[4].label),1)])),_:1}),f(t,{class:"account-info-value"},{default:u((()=>[d(r(fa.value[4].value||"--"),1)])),_:1})])),_:1}),K.value?(i(),c(e,{key:0,class:"account-info-row"},{default:u((()=>[f(t,{class:"account-info-label"},{default:u((()=>[d("差额")])),_:1}),f(t,{class:"account-info-value"},{default:u((()=>[d(r($.value.diffExpense||"--"),1)])),_:1})])),_:1})):g("",!0)])),_:1}),K.value?(i(),c(e,{key:0,class:"account-info-block",style:{"margin-top":"20rpx"}},{default:u((()=>[f(e,{class:"account-info-row"},{default:u((()=>[f(t,{class:"account-info-label"},{default:u((()=>[d("收款名称")])),_:1}),f(t,{class:"account-info-value"},{default:u((()=>[d(r($.value.receivingBankName||"--"),1)])),_:1})])),_:1}),f(e,{class:"account-info-row"},{default:u((()=>[f(t,{class:"account-info-label"},{default:u((()=>[d("开户银行")])),_:1}),f(t,{class:"account-info-value"},{default:u((()=>[d(r($.value.receivingBankAccountName||"--"),1)])),_:1})])),_:1}),f(e,{class:"account-info-row"},{default:u((()=>[f(t,{class:"account-info-label"},{default:u((()=>[d("帐号")])),_:1}),f(t,{class:"account-info-value"},{default:u((()=>[d(r($.value.receivingBankAccountNumber||"--"),1)])),_:1})])),_:1})])),_:1})):g("",!0),f(e,{class:"account-info-block",style:{"margin-top":"20rpx"}},{default:u((()=>[f(e,{class:"account-info-row"},{default:u((()=>[f(t,{class:"account-info-label"},{default:u((()=>[d(r(fa.value[5].label),1)])),_:1}),f(t,{class:"account-info-value"},{default:u((()=>[d(r(fa.value[5].value||"--"),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):g("",!0)])),_:1})])),_:1}),f(e,{class:"section"},{default:u((()=>[f(e,{class:"section-title-2",onClick:l[1]||(l[1]=a=>o(X)(o(D)))},{default:u((()=>[f(e,{class:"section-title-2-left"},{default:u((()=>[f(t,{class:"section-title-vertical"}),f(t,{class:"section-title-text"},{default:u((()=>[d("关联发票")])),_:1})])),_:1}),f(e,{class:v(["section-title-2-right",{active:o(V)(o(D))}])},null,8,["class"])])),_:1}),f(y,{name:"collapse"},{default:u((()=>[o(V)(o(D))?(i(),c(e,{key:0,class:"account-info-section"},{default:u((()=>[f(e,{class:"account-card"},{default:u((()=>[f(e,{class:"account-info-block"},{default:u((()=>[f(e,{class:"account-info-row"},{default:u((()=>[f(t,{class:"account-info-label"},{default:u((()=>[d("发票系统编号")])),_:1}),f(t,{class:"account-info-value"},{default:u((()=>[d(r($.value.invoiceCloudId||"--"),1)])),_:1})])),_:1}),f(e,{class:"account-info-row"},{default:u((()=>[f(t,{class:"account-info-label"},{default:u((()=>[d("专票金额(含税)")])),_:1}),f(t,{class:"account-info-value"},{default:u((()=>[d(r(o(N)($.value.vatamount)||""),1)])),_:1})])),_:1}),f(e,{class:"account-info-row"},{default:u((()=>[f(t,{class:"account-info-label"},{default:u((()=>[d("可抵扣票据")])),_:1}),f(t,{class:"account-info-value"},{default:u((()=>[d(r(o(N)($.value.vatamountNet)||""),1)])),_:1})])),_:1}),f(e,{class:"account-info-row"},{default:u((()=>[f(t,{class:"account-info-label"},{default:u((()=>[d("普票金额")])),_:1}),f(t,{class:"account-info-value"},{default:u((()=>[d(r(o(N)($.value.vatoamount)||""),1)])),_:1})])),_:1}),f(e,{class:"account-info-row"},{default:u((()=>[f(t,{class:"account-info-label"},{default:u((()=>[d("进项税额")])),_:1}),f(t,{class:"account-info-value"},{default:u((()=>[d(r(o(N)($.value.vattaxAmount)||""),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):g("",!0)])),_:1})])),_:1}),f(e,{class:"section"},{default:u((()=>[f(e,{class:"section-title-2",onClick:l[2]||(l[2]=a=>o(X)(o(T)))},{default:u((()=>[f(e,{class:"section-title-2-left"},{default:u((()=>[f(t,{class:"section-title-vertical"}),f(t,{class:"section-title-text"},{default:u((()=>[d("附件")])),_:1})])),_:1}),f(e,{class:v(["section-title-2-right",{active:o(V)(o(T))}])},null,8,["class"])])),_:1}),f(y,{name:"collapse"},{default:u((()=>[o(V)(o(T))?(i(),c(e,{key:0,class:"attachment-section"},{default:u((()=>[f(P,{list:J.value},null,8,["list"])])),_:1})):g("",!0)])),_:1})])),_:1}),f(e,{class:"section"},{default:u((()=>[f(e,{class:"section-title-2",onClick:l[3]||(l[3]=a=>o(X)(o(R)))},{default:u((()=>[f(e,{class:"section-title-2-left"},{default:u((()=>[f(t,{class:"section-title-vertical"}),f(t,{class:"section-title-text"},{default:u((()=>[d("审批记录")])),_:1})])),_:1}),f(e,{class:v(["section-title-2-right",{active:o(V)(o(R))}])},null,8,["class"])])),_:1}),f(y,{name:"collapse"},{default:u((()=>[o(V)(o(R))?(i(),c(e,{key:0,class:"approval-record-section"},{default:u((()=>[f(B,{list:o(oa)},null,8,["list"])])),_:1})):g("",!0)])),_:1})])),_:1})])),_:1}),f(U,{ref_key:"inputDialogRef",ref:Z,required:o(aa),title:o(la),placeholder:o(ea),onConfirm:o(ta),onCancel:o(sa)},null,8,["required","title","placeholder","onConfirm","onCancel"])])),_:1})}}},[["__scopeId","data-v-57fc3018"]]);export{L as default};
