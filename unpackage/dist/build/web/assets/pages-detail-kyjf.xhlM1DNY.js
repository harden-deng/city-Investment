import{u as a,W as e,R as l,r as t,l as u,D as c,c as s,w as o,E as n,i,o as f,b as d,d as r,x as v,v as _,q as p,t as m,F as b,J as y,K as k,X as g,Q as h,y as C,S as w}from"./index-DszEigh-.js";import{o as j}from"./uni-app.es.yxr7YjqI.js";import{F as A,A as N,P as x,b as T,c as E,a as I}from"./uni-popup.C2LCYpza.js";import{h as R}from"./request.CCTae_dV.js";import{u as B,a as D,d as F,b as P,c as q,I as U}from"./attachmentList.DtrauFz4.js";import{_ as L}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-nav-bar.CQxrnHAm.js";import"./uni-icons.Bqff-X7n.js";import"./uni-easyinput.BqZ0_ocZ.js";const S=L({__name:"kyjf",setup(L){let S;a((a=>({"4959ed6b":n(Q)})));let M=null;j((()=>{var a,l,t;S=null==(t=null==(l=null==(a=e())?void 0:a.proxy)?void 0:l.getOpenerEventChannel)?void 0:t.call(l),M=a=>{G.value=a.type,H.value=a.order,da(),la()},S.on("open-detail",M)})),l((()=>{S&&M&&S.off("open-detail",M),M=null}));const G=t(""),H=t({}),J=t([]),K=u((()=>"Running"==fa.value.wfstatus?"流转中":"Completed"==fa.value.wfstatus?"已审批":"")),O=t([]),{listHeight:Q}=B({headerSelector:".header-stickt",iosFit:!0}),{inputDialogRef:W,inputDialogRequired:X,inputDialogTitle:z,inputDialogPlaceholder:V,handleInputConfirm:Y,handleInputCancel:Z,onReject:$,onApprove:aa,approvalRecordList:ea,getApprovalRecord:la}=D({itemDetail:H,currentType:G,successMessage:"已审批",autoGoBack:!0,autoRefresh:!0}),ta=c({[A]:!0,[N]:!0,[x]:!0,[T]:!0}),ua=a=>{ta[a]=!ta[a]},ca=a=>ta[a],sa=u((()=>({pending:{procCode:H.value.procDefCode,workitemid:H.value.workItemId},completed:{procCode:H.value.procDefCode,wfInstanceId:H.value.wfinstanceId}}[G.value]))),oa=t([{label:"用款部门",value:"",key:"businessUnitName"},{label:"申请人",value:"",key:"submittedByName"},{label:"付款单位",value:"",key:"projecCompany"},{label:"付款帐号",value:"",key:"paymentAccount"},{label:"付款银行",value:"",key:"paymentBank"},{label:"收款单位",value:"",key:"receiverCompany"},{label:"收款帐号",value:"",key:"receiverAccountNumber"},{label:"收款银行",value:"",key:"receiverBankName"}]),na=t([{label:"课题名称",value:"",key:"projectTopicName"},{label:"立项单位",value:"",key:"projectApprovalUnit"},{label:"立项预算科目名称",value:"",key:"budgetAccountName"},{label:"资金来源",value:"",key:"fundSource"},{label:"总经费余额（不含本次）",value:"",key:"remainFundExcludeCurrent"},{label:"科目余额（不含本次）",value:"",key:"remainAccountFundExcludeCurrent"},{label:"预算金额",value:"",key:"planToPayTotal"},{label:"已使用/占用金额",value:"",key:"occBudgetAmount"},{label:"可用预算金额",value:"",key:"availableBudgetAmount"},{label:"计划支付金额",value:"",key:"planToPay"},{label:"支付内容",value:"",key:"paymentContent"}]),ia=t(["remainFundExcludeCurrent","remainAccountFundExcludeCurrent","planToPay","planToPayTotal","occBudgetAmount","availableBudgetAmount"]),fa=t({}),da=()=>{R.get(E[G.value],sa.value).then((a=>{var e,l;let t=(null==(e=a.data)?void 0:e.data)||{};fa.value=t||{},oa.value.forEach((a=>{a.value="number"==typeof fa.value[a.key]?I(fa.value[a.key]):fa.value[a.key]||""})),na.value.forEach((a=>{a.value="number"==typeof fa.value[a.key]||ia.value.includes(a.key)?I(fa.value[a.key]):fa.value[a.key]||""})),fa.value.projectApprovalUnit&&J.value.push(fa.value.projectApprovalUnit),fa.value.budgetAccountName&&J.value.push(fa.value.budgetAccountName);let u=((null==(l=fa.value)?void 0:l.attachmentList)||[]).map((a=>({fileTagName:a.fileTagName,fileName:a.fileName,fileUrl:a.fileUrl,id:a.attachmentId})));O.value=[{fileTagName:"合同",children:[]},{fileTagName:"课题预算表",children:[]},{fileTagName:"发票",children:[]}];const c=new Map;O.value.forEach((a=>{c.set(a.fileTagName,a)})),u.forEach((a=>{const e=c.get(a.fileTagName);e&&e.children.push(a)}))}))};return(a,e)=>{const l=i,t=C,u=w;return f(),s(l,{class:"detail-page"},{default:o((()=>[d(l,{class:"header-stickt"},{default:o((()=>[d(F),d(l,{class:"hero-card"},{default:o((()=>[d(l,{class:"hero-header"},{default:o((()=>[d(l,{class:"project-name"},{default:o((()=>[d(l,{class:"project-name-1"},{default:o((()=>[r(v(H.value.taskName),1)])),_:1}),d(l,{class:"project-name-1"},{default:o((()=>[r(v(fa.value.projecCompany),1)])),_:1})])),_:1}),d(l,{class:"amount-box"},{default:o((()=>[d(l,{class:"amount-label"},{default:o((()=>[r("申请支付总金额")])),_:1}),d(l,{class:"amount-value"},{default:o((()=>[d(t,{class:"amount-value-symbol"},{default:o((()=>[r("¥")])),_:1}),d(t,{class:"amount-value-number"},{default:o((()=>[r(v(n(I)(fa.value.planToPay)),1)])),_:1})])),_:1})])),_:1})])),_:1}),d(l,{class:_(["hero-tags",{"hero-tags-width":"pending"!=G.value}])},{default:o((()=>[(f(!0),p(b,null,m(J.value,((a,e)=>(f(),s(l,{class:"tag",key:e},{default:o((()=>[r(v(a),1)])),_:2},1024)))),128))])),_:1},8,["class"]),y(d(l,{class:"hero-actions"},{default:o((()=>[d(l,{class:"btn outline",onClick:n($)},{default:o((()=>[r("打回")])),_:1},8,["onClick"]),d(l,{class:"btn primary",onClick:n(aa)},{default:o((()=>[r("通过")])),_:1},8,["onClick"])])),_:1},512),[[k,"pending"===G.value]]),y(d(l,{class:"wfstatus-actions"},{default:o((()=>[r(v(K.value),1)])),_:1},512),[[k,"completed"===G.value&&("Running"==fa.value.wfstatus||"Completed"==fa.value.wfstatus)]])])),_:1})])),_:1}),d(u,{"scroll-y":"true",class:"scroller"},{default:o((()=>[d(l,{class:"section"},{default:o((()=>[d(l,{class:"section-title"},{default:o((()=>[d(t,{class:"section-title-vertical"}),d(t,{class:"section-title-text"},{default:o((()=>[r("基本信息")])),_:1})])),_:1}),d(l,{class:"account-info-section"},{default:o((()=>[d(l,{style:{height:"10rpx"}}),d(l,{class:"account-card"},{default:o((()=>[d(l,{class:"account-info-block"},{default:o((()=>[d(l,{class:"account-info-row"},{default:o((()=>[d(t,{class:"account-info-label"},{default:o((()=>[r(v(oa.value[0].label),1)])),_:1}),d(t,{class:"account-info-value"},{default:o((()=>[r(v(oa.value[0].value),1)])),_:1})])),_:1}),d(l,{class:"account-info-row"},{default:o((()=>[d(t,{class:"account-info-label"},{default:o((()=>[r(v(oa.value[1].label),1)])),_:1}),d(t,{class:"account-info-value"},{default:o((()=>[r(v(oa.value[1].value),1)])),_:1})])),_:1})])),_:1})])),_:1}),d(l,{class:"account-card margin_1"},{default:o((()=>[d(l,{class:"account-info-block"},{default:o((()=>[d(l,{class:"account-info-row"},{default:o((()=>[d(t,{class:"account-info-label"},{default:o((()=>[r(v(oa.value[2].label),1)])),_:1}),d(t,{class:"account-info-value"},{default:o((()=>[r(v(oa.value[2].value),1)])),_:1})])),_:1}),d(l,{class:"account-info-row"},{default:o((()=>[d(t,{class:"account-info-label"},{default:o((()=>[r(v(oa.value[3].label),1)])),_:1}),d(t,{class:"account-info-value"},{default:o((()=>[r(v(oa.value[3].value),1)])),_:1})])),_:1}),d(l,{class:"account-info-row"},{default:o((()=>[d(t,{class:"account-info-label"},{default:o((()=>[r(v(oa.value[4].label),1)])),_:1}),d(t,{class:"account-info-value"},{default:o((()=>[r(v(oa.value[4].value),1)])),_:1})])),_:1})])),_:1})])),_:1}),d(l,{class:"account-card margin_1"},{default:o((()=>[d(l,{class:"account-info-block"},{default:o((()=>[d(l,{class:"account-info-row"},{default:o((()=>[d(t,{class:"account-info-label"},{default:o((()=>[r(v(oa.value[5].label),1)])),_:1}),d(t,{class:"account-info-value"},{default:o((()=>[r(v(oa.value[5].value),1)])),_:1})])),_:1}),d(l,{class:"account-info-row"},{default:o((()=>[d(t,{class:"account-info-label"},{default:o((()=>[r(v(oa.value[6].label),1)])),_:1}),d(t,{class:"account-info-value"},{default:o((()=>[r(v(oa.value[6].value),1)])),_:1})])),_:1}),d(l,{class:"account-info-row"},{default:o((()=>[d(t,{class:"account-info-label"},{default:o((()=>[r(v(oa.value[7].label),1)])),_:1}),d(t,{class:"account-info-value"},{default:o((()=>[r(v(oa.value[7].value),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),d(l,{class:"section"},{default:o((()=>[d(l,{class:"section-title-2",onClick:e[0]||(e[0]=a=>ua(n(A)))},{default:o((()=>[d(l,{class:"section-title-2-left"},{default:o((()=>[d(t,{class:"section-title-vertical"}),d(t,{class:"section-title-text"},{default:o((()=>[r("课题信息")])),_:1})])),_:1}),d(l,{class:_(["section-title-2-right",{active:ca(n(A))}])},null,8,["class"])])),_:1}),d(g,{name:"collapse"},{default:o((()=>[ca(n(A))?(f(),s(l,{key:0,class:"info-list"},{default:o((()=>[(f(!0),p(b,null,m(na.value,((a,e)=>(f(),s(l,{class:_(["info-item",{"info-item-border":"remainAccountFundExcludeCurrent"===a.key||"availableBudgetAmount"===a.key}]),key:e},{default:o((()=>[d(t,{class:_(["info-label",{"info-label-width":"projectTopicName"===a.key}])},{default:o((()=>[r(v(a.label),1)])),_:2},1032,["class"]),d(t,{class:"info-value"},{default:o((()=>[r(v(a.value||"--"),1)])),_:2},1024)])),_:2},1032,["class"])))),128))])),_:1})):h("",!0)])),_:1})])),_:1}),d(l,{class:"section"},{default:o((()=>[d(l,{class:"section-title-2",onClick:e[1]||(e[1]=a=>ua(n(x)))},{default:o((()=>[d(l,{class:"section-title-2-left"},{default:o((()=>[d(t,{class:"section-title-vertical"}),d(t,{class:"section-title-text"},{default:o((()=>[r("补充信息")])),_:1})])),_:1}),d(l,{class:_(["section-title-2-right",{active:ca(n(x))}])},null,8,["class"])])),_:1}),d(g,{name:"collapse"},{default:o((()=>[ca(n(x))?(f(),s(l,{key:0,class:"account-info-section"},{default:o((()=>[d(l,{class:"account-card"},{default:o((()=>[d(l,{class:"account-info-block"},{default:o((()=>[d(l,{class:"account-info-row"},{default:o((()=>[d(t,{class:"account-info-label"},{default:o((()=>[r("发票系统编号")])),_:1}),d(t,{class:"account-info-value"},{default:o((()=>[r(v(fa.value.invoiceCloudId||""),1)])),_:1})])),_:1}),d(l,{class:"account-info-row"},{default:o((()=>[d(t,{class:"account-info-label"},{default:o((()=>[r("专票金额(含税)")])),_:1}),d(t,{class:"account-info-value"},{default:o((()=>[r(v(n(I)(fa.value.vatamount)||""),1)])),_:1})])),_:1}),d(l,{class:"account-info-row"},{default:o((()=>[d(t,{class:"account-info-label"},{default:o((()=>[r("普票金额")])),_:1}),d(t,{class:"account-info-value"},{default:o((()=>[r(v(n(I)(fa.value.vatoamount)||""),1)])),_:1})])),_:1}),d(l,{class:"account-info-row"},{default:o((()=>[d(t,{class:"account-info-label"},{default:o((()=>[r("可抵扣票据")])),_:1}),d(t,{class:"account-info-value"},{default:o((()=>[r(v(n(I)(fa.value.vatamountNet)||""),1)])),_:1})])),_:1}),d(l,{class:"account-info-row"},{default:o((()=>[d(t,{class:"account-info-label"},{default:o((()=>[r("进项税额")])),_:1}),d(t,{class:"account-info-value"},{default:o((()=>[r(v(n(I)(fa.value.vattaxAmount)||""),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):h("",!0)])),_:1})])),_:1}),d(l,{class:"section"},{default:o((()=>[d(l,{class:"section-title-2",onClick:e[2]||(e[2]=a=>ua(n(T)))},{default:o((()=>[d(l,{class:"section-title-2-left"},{default:o((()=>[d(t,{class:"section-title-vertical"}),d(t,{class:"section-title-text"},{default:o((()=>[r("附件")])),_:1})])),_:1}),d(l,{class:_(["section-title-2-right",{active:ca(n(T))}])},null,8,["class"])])),_:1}),d(g,{name:"collapse"},{default:o((()=>[ca(n(T))?(f(),s(l,{key:0,class:"attachment-section"},{default:o((()=>[d(P,{list:O.value},null,8,["list"])])),_:1})):h("",!0)])),_:1})])),_:1}),d(l,{class:"section"},{default:o((()=>[d(l,{class:"section-title-2",onClick:e[3]||(e[3]=a=>ua(n(N)))},{default:o((()=>[d(l,{class:"section-title-2-left"},{default:o((()=>[d(t,{class:"section-title-vertical"}),d(t,{class:"section-title-text"},{default:o((()=>[r("审批记录")])),_:1})])),_:1}),d(l,{class:_(["section-title-2-right",{active:ca(n(N))}])},null,8,["class"])])),_:1}),d(g,{name:"collapse"},{default:o((()=>[ca(n(N))?(f(),s(l,{key:0,class:"approval-record-section"},{default:o((()=>[d(q,{list:n(ea)},null,8,["list"])])),_:1})):h("",!0)])),_:1})])),_:1})])),_:1}),d(U,{ref_key:"inputDialogRef",ref:W,required:n(X),title:n(z),placeholder:n(V),onConfirm:n(Y),onCancel:n(Z)},null,8,["required","title","placeholder","onConfirm","onCancel"])])),_:1})}}},[["__scopeId","data-v-2cf87f86"]]);export{S as default};
