import{u as e,W as l,R as a,r as t,l as s,D as u,c,w as i,E as o,i as n,o as d,b as v,d as r,x as f,v as p,q as m,t as y,F as k,J as _,K as b,X as h,Q as g,H as C,Y as x,y as N,S as R}from"./index-DszEigh-.js";import{o as j}from"./uni-app.es.yxr7YjqI.js";import{F as T,A as w,P as A,b as I,c as D,a as z,d as q,h as E}from"./uni-popup.C2LCYpza.js";import{h as V}from"./request.CCTae_dV.js";import{u as U,a as F,d as L,b as H,c as M,I as P}from"./attachmentList.DtrauFz4.js";import{_ as S}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-nav-bar.CQxrnHAm.js";import"./uni-icons.Bqff-X7n.js";import"./uni-easyinput.BqZ0_ocZ.js";const B=S({__name:"cbqr",setup(S){let B;e((e=>({"02c04b74":o(X)})));let G=null;j((()=>{var e,a,t;B=null==(t=null==(a=null==(e=l())?void 0:e.proxy)?void 0:a.getOpenerEventChannel)?void 0:t.call(a),G=e=>{J.value=e.type,K.value=e.order,me(),ce()},B.on("open-detail",G)})),a((()=>{B&&G&&B.off("open-detail",G),G=null}));const J=t(""),K=t({}),O=t([]),Q=s((()=>"Running"==pe.value.wfstatus?"流转中":"Completed"==pe.value.wfstatus?"已审批":"")),W=t([]),{listHeight:X}=U({headerSelector:".header-stickt",iosFit:!0}),{inputDialogRef:Y,inputDialogRequired:Z,inputDialogTitle:$,inputDialogPlaceholder:ee,handleInputConfirm:le,handleInputCancel:ae,onReject:te,onApprove:se,approvalRecordList:ue,getApprovalRecord:ce}=F({itemDetail:K,currentType:J,successMessage:"已审批",autoGoBack:!0,autoRefresh:!0}),ie=u({[T]:!0,[w]:!0,[A]:!0,[I]:!0}),oe=e=>{ie[e]=!ie[e]},ne=e=>ie[e],de=s((()=>({pending:{procCode:K.value.procDefCode,workitemid:K.value.workItemId},completed:{procCode:K.value.procDefCode,wfInstanceId:K.value.wfinstanceId}}[J.value]))),ve=t([{label:"合同名称",value:"",key:"relatedContractName"},{label:"合同编号",value:"",key:"contractNo"},{label:"合同子项",value:"",key:"relatedContractItemName"},{label:"项目名称",value:"",key:"projectName"},{label:"所属部门",value:"",key:"businessUnitName"},{label:"对方单位",value:"",key:"partyName"},{label:"合同金额",value:"",key:"contractAmountVat"},{label:"对应收入合同编号",value:"",key:"receivingContractNo"},{label:"是否已收到发票",value:"",key:"invoiceReceived"}]),re=t([{label:"发票号",value:"",key:"invoiceId"},{label:"专票含税金额",value:"",key:"invoiceAmountVat"},{label:"专票不含税金额",value:"",key:"invoiceAmountNet"},{label:"专票税额",value:"",key:"invoiceAmountTax"},{label:"普票金额",value:"",key:"invoiceAmountVato"}]),fe=t([{label:"确认日期",value:"",key:"confirmedDate"},{label:"本期确认成本量",value:"",key:"confirmedCostVat"},{label:"本期成本量占合同比% ",value:"",key:"contractRatio"},{label:"确认金额(含税)",value:"",key:"confirmedCostAmountVat"},{label:"增值税税额",value:"",key:"confirmedCostTaxAmount"},{label:"确认金额(不含税)",value:"",key:"confirmedCostAmountNet"},{label:"累计确认金额(含税)",value:"",key:"accuredConfirmedCostAmountVat"},{label:"内容",value:"",key:"content"},{label:"确认依据",value:"",key:"remark"}]),pe=t({}),me=()=>{V.get(D[J.value],de.value).then((e=>{var l,a;let t=(null==(l=e.data)?void 0:l.data)||{};pe.value=t||{},ve.value.forEach((e=>{e.value="number"==typeof pe.value[e.key]?z(pe.value[e.key]):pe.value[e.key],"invoiceReceived"==e.key&&[0,1].includes(pe.value[e.key])&&(e.value=0==pe.value[e.key]?"否":"是")})),re.value.forEach((e=>{e.value="number"==typeof pe.value[e.key]?z(pe.value[e.key]):pe.value[e.key]})),fe.value.forEach((e=>{e.value="number"==typeof pe.value[e.key]&&"contractRatio"!=e.key?z(pe.value[e.key]):pe.value[e.key],"contractRatio"==e.key&&(e.value=pe.value[e.key]+"%"||""),"confirmedDate"==e.key&&(e.value=q(pe.value[e.key])||"")})),pe.value.businessUnitName&&O.value.push(pe.value.businessUnitName);let s=((null==(a=pe.value)?void 0:a.attachmentList)||[]).map((e=>({fileTagName:e.fileTagName,fileName:e.fileName,fileUrl:e.fileUrl,id:e.attachmentId})));W.value=[{fileTagName:"合同",children:[]},{fileTagName:"发票/收据",children:[]},{fileTagName:"合同要求其他资料",children:[]},{fileTagName:"其他",children:[]}];const u=new Map;W.value.forEach((e=>{u.set(e.fileTagName,e)})),s.forEach((e=>{const l=u.get(e.fileTagName);l&&l.children.push(e)}))}))};return(e,l)=>{const a=n,t=N,s=R;return d(),c(a,{class:"detail-page"},{default:i((()=>[v(a,{class:"header-stickt"},{default:i((()=>[v(L),v(a,{class:"hero-card"},{default:i((()=>[v(a,{class:"hero-header"},{default:i((()=>[v(a,{class:"project-name"},{default:i((()=>[v(a,{class:"project-name-1"},{default:i((()=>[r(f(K.value.taskName),1)])),_:1}),v(a,{class:"project-name-1"},{default:i((()=>[r(f(pe.value.contractName),1)])),_:1})])),_:1}),v(a,{class:"amount-box"},{default:i((()=>[v(a,{class:"amount-label"},{default:i((()=>[r("申请金额")])),_:1}),v(a,{class:"amount-value"},{default:i((()=>[v(t,{class:"amount-value-symbol"},{default:i((()=>[r("¥")])),_:1}),v(t,{class:"amount-value-number"},{default:i((()=>[r(f(o(z)(pe.value.confirmedCostAmountVat)),1)])),_:1})])),_:1})])),_:1})])),_:1}),v(a,{class:p(["hero-tags",{"hero-tags-width":"pending"!=J.value}])},{default:i((()=>[(d(!0),m(k,null,y(O.value,((e,l)=>(d(),c(a,{class:"tag",key:l},{default:i((()=>[r(f(e),1)])),_:2},1024)))),128))])),_:1},8,["class"]),_(v(a,{class:"hero-actions"},{default:i((()=>[v(a,{class:"btn outline",onClick:o(te)},{default:i((()=>[r("打回")])),_:1},8,["onClick"]),v(a,{class:"btn primary",onClick:o(se)},{default:i((()=>[r("通过")])),_:1},8,["onClick"])])),_:1},512),[[b,"pending"===J.value]]),_(v(a,{class:"wfstatus-actions"},{default:i((()=>[r(f(Q.value),1)])),_:1},512),[[b,"completed"===J.value&&("Running"==pe.value.wfstatus||"Completed"==pe.value.wfstatus)]])])),_:1})])),_:1}),v(s,{"scroll-y":"true",class:"scroller"},{default:i((()=>[v(a,{class:"section"},{default:i((()=>[v(a,{class:"section-title"},{default:i((()=>[v(t,{class:"section-title-vertical"}),v(t,{class:"section-title-text"},{default:i((()=>[r("基本信息")])),_:1})])),_:1}),v(a,{class:"info-list"},{default:i((()=>[(d(!0),m(k,null,y(ve.value,((e,l)=>(d(),c(a,{class:"info-item",key:l},{default:i((()=>[v(t,{class:"info-label"},{default:i((()=>[r(f(e.label),1)])),_:2},1024),v(t,{class:"info-value"},{default:i((()=>[r(f(e.value||"--"),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1}),1==pe.value.invoiceReceived?(d(),c(a,{key:0,class:"section"},{default:i((()=>[v(a,{class:"section-title-2",onClick:l[0]||(l[0]=e=>oe(o(T)))},{default:i((()=>[v(a,{class:"section-title-2-left"},{default:i((()=>[v(t,{class:"section-title-vertical"}),v(t,{class:"section-title-text"},{default:i((()=>[r("发票信息")])),_:1})])),_:1}),v(a,{class:p(["section-title-2-right",{active:ne(o(T))}])},null,8,["class"])])),_:1}),v(h,{name:"collapse"},{default:i((()=>[ne(o(T))?(d(),c(a,{key:0,class:"info-list"},{default:i((()=>[(d(!0),m(k,null,y(re.value,((e,l)=>(d(),c(a,{class:"info-item",key:l},{default:i((()=>[v(t,{class:"info-label"},{default:i((()=>[r(f(e.label),1)])),_:2},1024),v(t,{class:"info-value"},{default:i((()=>[r(f(e.value||"--"),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})):g("",!0)])),_:1})])),_:1})):g("",!0),v(a,{class:"section"},{default:i((()=>[v(a,{class:"section-title-2",onClick:l[1]||(l[1]=e=>oe(o(A)))},{default:i((()=>[v(a,{class:"section-title-2-left"},{default:i((()=>[v(t,{class:"section-title-vertical"}),v(t,{class:"section-title-text"},{default:i((()=>[r("确认成本信息")])),_:1})])),_:1}),v(a,{class:p(["section-title-2-right",{active:ne(o(A))}])},null,8,["class"])])),_:1}),v(h,{name:"collapse"},{default:i((()=>[ne(o(A))?(d(),c(a,{key:0,class:"usage-details"},{default:i((()=>[v(s,{"scroll-x":"",class:"table-scroll-x",onTouchmove:C(o(E),["stop"])},{default:i((()=>[x("table",{cellspacing:"0",cellpadding:"0",class:"table1"},[x("tbody",null,[x("tr",null,[x("td",{class:"type sticky-xz-1"},f(fe.value[0].label),1),x("td",{class:"info info-plus"},f(fe.value[0].value),1)]),x("tr",null,[x("td",{class:"type sticky-xz-1"},f(fe.value[1].label),1),x("td",{class:"info info-plus"},f(fe.value[1].value),1)]),x("tr",null,[x("td",{class:"type sticky-xz-1"},f(fe.value[2].label),1),x("td",{class:"info info-plus"},f(fe.value[2].value),1)]),x("tr",null,[x("td",{class:"type sticky-xz-1"},f(fe.value[3].label),1),x("td",{class:"info info-plus"},f(fe.value[3].value),1)]),x("tr",null,[x("td",{class:"type sticky-xz-1"},f(fe.value[4].label),1),x("td",{class:"info info-plus"},f(fe.value[4].value),1)]),x("tr",null,[x("td",{class:"type sticky-xz-1"},f(fe.value[5].label),1),x("td",{class:"info info-plus"},f(fe.value[5].value),1)]),x("tr",null,[x("td",{class:"type sticky-xz-1"},f(fe.value[6].label),1),x("td",{class:"info info-plus"},f(fe.value[6].value),1)]),x("tr",null,[x("td",{class:"type sticky-xz-1"},f(fe.value[7].label),1),x("td",{class:"info info-plus"},f(fe.value[7].value),1)]),x("tr",null,[x("td",{class:"type sticky-xz-1"},f(fe.value[8].label),1),x("td",{class:"info info-plus"},f(fe.value[8].value),1)])])])])),_:1},8,["onTouchmove"])])),_:1})):g("",!0)])),_:1})])),_:1}),v(a,{class:"section"},{default:i((()=>[v(a,{class:"section-title-2",onClick:l[2]||(l[2]=e=>oe(o(I)))},{default:i((()=>[v(a,{class:"section-title-2-left"},{default:i((()=>[v(t,{class:"section-title-vertical"}),v(t,{class:"section-title-text"},{default:i((()=>[r("附件")])),_:1})])),_:1}),v(a,{class:p(["section-title-2-right",{active:ne(o(I))}])},null,8,["class"])])),_:1}),v(h,{name:"collapse"},{default:i((()=>[ne(o(I))?(d(),c(a,{key:0,class:"attachment-section"},{default:i((()=>[v(H,{list:W.value},null,8,["list"])])),_:1})):g("",!0)])),_:1})])),_:1}),v(a,{class:"section"},{default:i((()=>[v(a,{class:"section-title-2",onClick:l[3]||(l[3]=e=>oe(o(w)))},{default:i((()=>[v(a,{class:"section-title-2-left"},{default:i((()=>[v(t,{class:"section-title-vertical"}),v(t,{class:"section-title-text"},{default:i((()=>[r("审批记录")])),_:1})])),_:1}),v(a,{class:p(["section-title-2-right",{active:ne(o(w))}])},null,8,["class"])])),_:1}),v(h,{name:"collapse"},{default:i((()=>[ne(o(w))?(d(),c(a,{key:0,class:"approval-record-section"},{default:i((()=>[v(M,{list:o(ue)},null,8,["list"])])),_:1})):g("",!0)])),_:1})])),_:1})])),_:1}),v(P,{ref_key:"inputDialogRef",ref:Y,required:o(Z),title:o($),placeholder:o(ee),onConfirm:o(le),onCancel:o(ae)},null,8,["required","title","placeholder","onConfirm","onCancel"])])),_:1})}}},[["__scopeId","data-v-92aad831"]]);export{B as default};
