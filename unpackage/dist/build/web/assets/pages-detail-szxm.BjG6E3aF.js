import{u as a,W as e,R as l,r as t,l as s,D as c,c as n,w as u,E as o,i,o as d,b as f,d as r,x as v,q as p,t as m,F as _,J as y,K as k,v as g,Q as b,X as x,Y as C,y as h,S as R}from"./index-DszEigh-.js";import{o as w}from"./uni-app.es.yxr7YjqI.js";import{F as N,P as A,C as I,A as z,b as j,c as B,a as D}from"./uni-popup.C2LCYpza.js";import{h as P}from"./request.CCTae_dV.js";import{u as T,a as q,d as O,b as E,c as U,I as M}from"./attachmentList.DtrauFz4.js";import{_ as S}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-nav-bar.CQxrnHAm.js";import"./uni-icons.Bqff-X7n.js";import"./uni-easyinput.BqZ0_ocZ.js";const V=S({__name:"szxm",setup(S){let V;a((a=>({"6389b45d":o(K)})));let F=null;w((()=>{var a,l,t;V=null==(t=null==(l=null==(a=e())?void 0:a.proxy)?void 0:l.getOpenerEventChannel)?void 0:t.call(l),F=a=>{L.value=a.type,W.value=a.order,fa(),sa()},V.on("open-detail",F)})),l((()=>{V&&F&&V.off("open-detail",F),F=null}));const L=t(""),W=t({}),G=t([]),H=s((()=>"Running"==da.value.wfstatus?"流转中":"Completed"==da.value.wfstatus?"已审批":"")),J=t([]),{listHeight:K}=T({headerSelector:".header-stickt",iosFit:!0}),{inputDialogRef:Q,inputDialogRequired:X,inputDialogTitle:Y,inputDialogPlaceholder:Z,handleInputConfirm:$,handleInputCancel:aa,onReject:ea,onApprove:la,approvalRecordList:ta,getApprovalRecord:sa}=q({itemDetail:W,currentType:L,successMessage:"已审批",autoGoBack:!0,autoRefresh:!0}),ca=c({[N]:!0,[A]:!0,[I]:!0,[z]:!0,[j]:!0}),na=a=>{ca[a]=!ca[a]},ua=a=>ca[a],oa=s((()=>({pending:{procCode:W.value.procDefCode,workitemid:W.value.workItemId},completed:{procCode:W.value.procDefCode,wfInstanceId:W.value.wfinstanceId}}[L.value]))),ia=t([{label:"用款部门",value:"",key:"businessUnitName"},{label:"申请人",value:"",key:"applicantName"},{label:"付款合同",value:"",key:"contractName"},{label:"合同编号",value:"",key:"contractNo"},{label:"合同价",value:"",key:"contractAmountVat"},{label:"决算价",value:"",key:"contractSettleAmountVat"},{label:"已完成工作量",value:"",key:"contractCompletedWorkload"},{label:"累计付款(含本次付款)",value:"",key:"contractAccPaymentIncludeCurrent"},{label:"付款比例",value:"",key:"contractPaymentRatio"}]),da=t({}),fa=()=>{P.get(B[L.value],oa.value).then((a=>{var e;let l=(null==(e=a.data)?void 0:e.data)||{};da.value=(null==l?void 0:l.wfrequestmarketingpayment)||{},ia.value.forEach((a=>{a.value="number"==typeof da.value[a.key]&&"contractPaymentRatio"!==a.key?D(da.value[a.key]):da.value[a.key]||""})),da.value.businessUnitName&&G.value.push(da.value.businessUnitName),da.value.specialCase&&"OutOfBudget"===da.value.specialCase&&G.value.push("预算外"),da.value.specialCase&&"OverBudget"===da.value.specialCase&&G.value.push("超预算");let t=((null==l?void 0:l.attachementList)||[]).map((a=>({fileTagName:a.fileTagName,fileName:a.fileName,fileUrl:a.fileUrl,id:a.attachmentId})));J.value=[{fileTagName:"合同",children:[]},{fileTagName:"发票/收据",children:[]},{fileTagName:"其他",children:[]}];const s=new Map;J.value.forEach((a=>{s.set(a.fileTagName,a)})),t.forEach((a=>{const e=s.get(a.fileTagName);e&&e.children.push(a)}))}))};return(a,e)=>{const l=i,t=h,s=R;return d(),n(l,{class:"detail-page"},{default:u((()=>[f(l,{class:"header-stickt"},{default:u((()=>[f(O),f(l,{class:"hero-card"},{default:u((()=>[f(l,{class:"hero-header"},{default:u((()=>[f(l,{class:"project-name"},{default:u((()=>[f(l,{class:"project-name-1"},{default:u((()=>[r(v(W.value.taskName),1)])),_:1}),f(l,{class:"project-name-1"},{default:u((()=>[r(" 上海市市政工程建设发展有限公司 ")])),_:1})])),_:1}),f(l,{class:"amount-box"},{default:u((()=>[f(l,{class:"amount-label"},{default:u((()=>[r("申请支付总金额")])),_:1}),f(l,{class:"amount-value"},{default:u((()=>[f(t,{class:"amount-value-symbol"},{default:u((()=>[r("¥")])),_:1}),f(t,{class:"amount-value-number"},{default:u((()=>[r(v(o(D)(da.value.paymentAmount)),1)])),_:1})])),_:1})])),_:1})])),_:1}),f(l,{class:"hero-tags"},{default:u((()=>[(d(!0),p(_,null,m(G.value,((a,e)=>(d(),n(l,{class:"tag",key:e},{default:u((()=>[r(v(a),1)])),_:2},1024)))),128))])),_:1}),y(f(l,{class:"hero-actions"},{default:u((()=>[f(l,{class:"btn outline",onClick:o(ea)},{default:u((()=>[r("打回")])),_:1},8,["onClick"]),f(l,{class:"btn primary",onClick:o(la)},{default:u((()=>[r("通过")])),_:1},8,["onClick"])])),_:1},512),[[k,"pending"===L.value]]),y(f(l,{class:"wfstatus-actions"},{default:u((()=>[r(v(H.value),1)])),_:1},512),[[k,"completed"===L.value&&("Running"==da.value.wfstatus||"Completed"==da.value.wfstatus)]])])),_:1})])),_:1}),f(s,{"scroll-y":"true",class:"scroller"},{default:u((()=>[f(l,{class:"section"},{default:u((()=>[f(l,{class:"section-title"},{default:u((()=>[f(t,{class:"section-title-vertical"}),f(t,{class:"section-title-text"},{default:u((()=>[r("基本信息")])),_:1})])),_:1}),f(l,{class:"info-list"},{default:u((()=>{var a;return[(d(!0),p(_,null,m(ia.value,((a,e)=>(d(),n(l,{class:g(["info-item",{"info-item-border":"contractNo"===a.key||"contractPaymentRatio"===a.key}]),key:e},{default:u((()=>[f(t,{class:"info-label"},{default:u((()=>[r(v(a.label),1)])),_:2},1024),f(t,{class:"info-value"},{default:u((()=>[r(v("contractPaymentRatio"===a.key?a.value+"%":a.value||"--"),1)])),_:2},1024)])),_:2},1032,["class"])))),128)),["OverBudget","OutOfBudget"].includes(da.value.specialCase)?(d(),n(l,{key:0,class:g(["info-item",{"info-item-column":(null==(a=da.value.specialRemark)?void 0:a.length)>34}])},{default:u((()=>{var a;return[f(t,{class:"info-label"},{default:u((()=>[r("补充说明")])),_:1}),f(t,{class:g(["info-value",{"info-value-left":(null==(a=da.value.specialRemark)?void 0:a.length)>34}])},{default:u((()=>[r(v(da.value.specialRemark||"--"),1)])),_:1},8,["class"])]})),_:1},8,["class"])):b("",!0)]})),_:1})])),_:1}),f(l,{class:"section"},{default:u((()=>[f(l,{class:"section-title-2",onClick:e[0]||(e[0]=a=>na(o(A)))},{default:u((()=>[f(l,{class:"section-title-2-left"},{default:u((()=>[f(t,{class:"section-title-vertical"}),f(t,{class:"section-title-text"},{default:u((()=>[r("付款内容")])),_:1})])),_:1}),f(l,{class:g(["section-title-2-right",{active:ua(o(A))}])},null,8,["class"])])),_:1}),f(x,{name:"collapse"},{default:u((()=>[ua(o(A))?(d(),n(l,{key:0,class:"account-info-section"},{default:u((()=>[f(l,{class:"account-card"},{default:u((()=>[f(l,{class:"account-info-block"},{default:u((()=>[f(l,{class:"account-info-row"},{default:u((()=>[f(t,{class:"account-info-label"},{default:u((()=>[r("付款内容")])),_:1}),f(t,{class:"account-info-value"},{default:u((()=>[r(v(da.value.paymentContent||""),1)])),_:1})])),_:1}),f(l,{class:"account-info-row"},{default:u((()=>[f(t,{class:"account-info-label"},{default:u((()=>[r("本次付款金额")])),_:1}),f(t,{class:"account-info-value"},{default:u((()=>[r(v(o(D)(da.value.paymentAmount)||""),1)])),_:1})])),_:1})])),_:1}),f(l,{class:"account-info-block",style:{"margin-top":"20rpx"}},{default:u((()=>[f(l,{class:"account-info-row"},{default:u((()=>[f(t,{class:"account-info-label"},{default:u((()=>[r("收款单位名称")])),_:1}),f(t,{class:"account-info-value"},{default:u((()=>[r(v(da.value.receivingCompany||""),1)])),_:1})])),_:1}),f(l,{class:"account-info-row"},{default:u((()=>[f(t,{class:"account-info-label"},{default:u((()=>[r("开户银行")])),_:1}),f(t,{class:"account-info-value"},{default:u((()=>[r(v(da.value.receivingBank||""),1)])),_:1})])),_:1}),f(l,{class:"account-info-row"},{default:u((()=>[f(t,{class:"account-info-label"},{default:u((()=>[r("账号")])),_:1}),f(t,{class:"account-info-value"},{default:u((()=>[r(v(da.value.receivingAccountNo||""),1)])),_:1})])),_:1})])),_:1}),f(l,{class:"account-info-block",style:{"margin-top":"20rpx"}},{default:u((()=>[f(l,{class:"account-info-row"},{default:u((()=>[f(t,{class:"account-info-label"},{default:u((()=>[r("普票金额")])),_:1}),f(t,{class:"account-info-value"},{default:u((()=>[r(v(o(D)(da.value.vatoamount)||""),1)])),_:1})])),_:1}),f(l,{class:"account-info-row"},{default:u((()=>[f(t,{class:"account-info-label"},{default:u((()=>[r("专票金额(含税)")])),_:1}),f(t,{class:"account-info-value"},{default:u((()=>[r(v(o(D)(da.value.vatamount)||""),1)])),_:1})])),_:1}),f(l,{class:"account-info-row"},{default:u((()=>[f(t,{class:"account-info-label"},{default:u((()=>[r("不含税金额")])),_:1}),f(t,{class:"account-info-value"},{default:u((()=>[r(v(o(D)(da.value.vatamountNet)||""),1)])),_:1})])),_:1}),f(l,{class:"account-info-row"},{default:u((()=>[f(t,{class:"account-info-label"},{default:u((()=>[r("进项税额")])),_:1}),f(t,{class:"account-info-value"},{default:u((()=>[r(v(o(D)(da.value.vattaxAmount)||""),1)])),_:1})])),_:1}),f(l,{class:"account-info-row"},{default:u((()=>[f(t,{class:"account-info-label"},{default:u((()=>[r("税率%")])),_:1}),f(t,{class:"account-info-value"},{default:u((()=>[r(v(da.value.taxRate?da.value.taxRate+"%":"--"),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):b("",!0)])),_:1})])),_:1}),da.value.relatedRecivingContractId?(d(),n(l,{key:0,class:"section"},{default:u((()=>[f(l,{class:"section-title-2",onClick:e[1]||(e[1]=a=>na(o(I)))},{default:u((()=>[f(l,{class:"section-title-2-left"},{default:u((()=>[f(t,{class:"section-title-vertical"}),f(t,{class:"section-title-text"},{default:u((()=>[r("关联合同情况")])),_:1})])),_:1}),f(l,{class:g(["section-title-2-right",{active:ua(o(I))}])},null,8,["class"])])),_:1}),f(x,{name:"collapse"},{default:u((()=>[ua(o(I))?(d(),n(l,{key:0,class:"usage-details"},{default:u((()=>[f(s,{"scroll-x":"",class:"table-scroll-x"},{default:u((()=>[C("table",{cellspacing:"0",cellpadding:"0",class:"table1"},[C("tbody",null,[C("tr",null,[C("td",{class:"type text sticky-xz-1"},"收款合同"),C("td",{class:"info info-plus"},v(da.value.relatedRecivingContractName),1)]),C("tr",null,[C("td",{class:"type text sticky-xz-1"},"合同编号"),C("td",{class:"info info-plus"},v(da.value.relatedRecivingContractNo),1)]),C("tr",null,[C("td",{class:"type text sticky-xz-1"},"业主单位"),C("td",{class:"info info-plus"},v(da.value.relatedRecivingContractCustomer),1)]),C("tr",null,[C("td",{class:"type text sticky-xz-1"},"合同价"),C("td",{class:"info info-plus"},v(o(D)(da.value.relatedRecivingContractAmountVat)),1)]),C("tr",null,[C("td",{class:"type text sticky-xz-1"},"决算价"),C("td",{class:"info info-plus"},v(o(D)(da.value.relatedRecivingContractSettleAmountVat)),1)]),C("tr",null,[C("td",{class:"type text sticky-xz-1"},"已完成工作量"),C("td",{class:"info info-plus"},v(o(D)(da.value.relatedRecivingContractAccWorkload)),1)]),C("tr",null,[C("td",{class:"type text sticky-xz-1"},"累计已收款"),C("td",{class:"info info-plus"},v(o(D)(da.value.relatedRecivingContractAccReceived)),1)]),C("tr",null,[C("td",{class:"type text sticky-xz-1"},"付款比例"),C("td",{class:"info info-plus"},v(da.value.relatedRecivingContractAccReceivedRatio+"%"),1)])])])])),_:1})])),_:1})):b("",!0)])),_:1})])),_:1})):b("",!0),da.value.relatedBudgetItemId?(d(),n(l,{key:1,class:"section"},{default:u((()=>[f(l,{class:"section-title-2",onClick:e[2]||(e[2]=a=>na(o(N)))},{default:u((()=>[f(l,{class:"section-title-2-left"},{default:u((()=>[f(t,{class:"section-title-vertical"}),f(t,{class:"section-title-text"},{default:u((()=>[r("预算关联信息")])),_:1})])),_:1}),f(l,{class:g(["section-title-2-right",{active:ua(o(N))}])},null,8,["class"])])),_:1}),f(x,{name:"collapse"},{default:u((()=>[ua(o(N))?(d(),n(l,{key:0,class:"usage-details"},{default:u((()=>[f(s,{"scroll-x":"",class:"table-scroll-x"},{default:u((()=>[C("table",{cellspacing:"0",cellpadding:"0",class:"table1"},[C("tbody",null,[C("tr",null,[C("td",{class:"type text sticky-xz-1"},"预算事项"),C("td",{class:"info info-plus"},v(da.value.relatedBudgetItemContent),1)]),C("tr",null,[C("td",{class:"type text sticky-xz-1"},"预算栏目"),C("td",{class:"info info-plus"},v(da.value.budgetCategoryName),1)]),C("tr",null,[C("td",{class:"type text sticky-xz-1"},"月度预算金额"),C("td",{class:"info info-plus"},v(o(D)(da.value.currentMonthBudgetAmount)),1)]),C("tr",null,[C("td",{class:"type text sticky-xz-1"},"当月累计支出数(含本次申请)"),C("td",{class:"info info-plus"},v(o(D)(da.value.currentMonthAccPaymentIncludeCurrent)),1)]),C("tr",null,[C("td",{class:"type text sticky-xz-1"},"年度预算金额"),C("td",{class:"info info-plus"},v(o(D)(da.value.yearlyBudgetAmount)),1)]),C("tr",null,[C("td",{class:"type text sticky-xz-1"},"年度累计支出(截至上月)"),C("td",{class:"info info-plus"},v(o(D)(da.value.yearlyAccPayment)),1)])])])])),_:1})])),_:1})):b("",!0)])),_:1})])),_:1})):b("",!0),f(l,{class:"section"},{default:u((()=>[f(l,{class:"section-title-2",onClick:e[3]||(e[3]=a=>na(o(j)))},{default:u((()=>[f(l,{class:"section-title-2-left"},{default:u((()=>[f(t,{class:"section-title-vertical"}),f(t,{class:"section-title-text"},{default:u((()=>[r("附件")])),_:1})])),_:1}),f(l,{class:g(["section-title-2-right",{active:ua(o(j))}])},null,8,["class"])])),_:1}),f(x,{name:"collapse"},{default:u((()=>[ua(o(j))?(d(),n(l,{key:0,class:"attachment-section"},{default:u((()=>[f(E,{list:J.value},null,8,["list"])])),_:1})):b("",!0)])),_:1})])),_:1}),f(l,{class:"section"},{default:u((()=>[f(l,{class:"section-title-2",onClick:e[4]||(e[4]=a=>na(o(z)))},{default:u((()=>[f(l,{class:"section-title-2-left"},{default:u((()=>[f(t,{class:"section-title-vertical"}),f(t,{class:"section-title-text"},{default:u((()=>[r("审批记录")])),_:1})])),_:1}),f(l,{class:g(["section-title-2-right",{active:ua(o(z))}])},null,8,["class"])])),_:1}),f(x,{name:"collapse"},{default:u((()=>[ua(o(z))?(d(),n(l,{key:0,class:"approval-record-section"},{default:u((()=>[f(U,{list:o(ta)},null,8,["list"])])),_:1})):b("",!0)])),_:1})])),_:1})])),_:1}),f(M,{ref_key:"inputDialogRef",ref:Q,required:o(X),title:o(Y),placeholder:o(Z),onConfirm:o($),onCancel:o(aa)},null,8,["required","title","placeholder","onConfirm","onCancel"])])),_:1})}}},[["__scopeId","data-v-3d4481a9"]]);export{V as default};
