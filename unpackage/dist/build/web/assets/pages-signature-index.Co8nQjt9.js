import{Y as t,X as a,k as e,o as s,c as n,w as i,b as r,t as o,M as l,_ as c,J as d,E as u,n as p,i as g,f as h,e as m,T as f,U as _,a9 as b,aj as w,af as k,ag as y,a as C,d as D,g as S}from"./index-CwTIEDZV.js";import{_ as T}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{r as v}from"./uni-app.es.DzoixSAQ.js";const x=T({name:"RnSignature",props:{options:{type:Object,default:()=>({})},data:{type:Object,default:()=>({url:""})}},computed:{clearClassName(){return this.optionsAll.clear.customClass},optionsAll(){return{...this.options,clear:{...this.config.clear,...this.options.clear||{}},placeholder:{...this.config.placeholder,...this.options.placeholder||{}},style:{...this.config.style,...this.options.style||{}}}}},data:()=>({config:{clear:{show:!0},style:{width:"100%",height:"300rpx",background:"#fff","box-shadow":"0px 0px 5px rgba(0, 0, 0, 0.4)",borderRadius:"20rpx"},placeholder:{content:"请点击设置签名"}}}),created(){},mounted(){},methods:{clearClick(){this.data.url=""},btnClick(){this.data.tempTime&&t(`rnReturnData${this.data.tempTime}`),this.data.tempTime=Date.now(),a(`rnReturnData${this.data.tempTime}`,(t=>{for(let a in t)this.data[a]=t[a]})),e({url:`/uni_modules/rn-signature/pages/rn-canvas?tempTime=${this.data.tempTime}`,success:t=>{t.eventChannel.emit(`receiveData${this.data.tempTime}`,{data:this.data,options:this.optionsAll})},fail:t=>{console.log("跳转页面：",t,this.data,"fail")}})}}},[["render",function(t,a,e,m,f,_){const b=g,w=h;return s(),n(b,{class:"rn_signature",style:p([_.optionsAll.style])},{default:i((()=>[r(b,{class:"sign_container",onClick:_.btnClick},{default:i((()=>[e.data.url?l("",!0):(s(),o("span",{key:0},"请点击设置签名")),e.data.url&&_.optionsAll.clear.show?(s(),o("span",{key:1,class:d({clear_url:!_.optionsAll.clear.slot,[_.clearClassName]:_.optionsAll.clear.slot}),onClick:a[0]||(a[0]=u(((...t)=>_.clearClick&&_.clearClick(...t)),["stop"]))},[c(t.$slots,"clearSlot",{},(()=>[r(b,{class:"icon_left"}),r(b,{class:"icon_right"})]),!0)],2)):l("",!0),e.data.url?(s(),n(w,{key:2,class:"signature_img",src:e.data.url,alt:""},null,8,["src"])):l("",!0)])),_:3},8,["onClick"])])),_:3},8,["style"])}],["__scopeId","data-v-24981eee"]]);const A=T({components:{RnSignature:x},data:()=>({signatureOptions:{clear:{show:!0},placeholder:{content:"请在下方区域进行签名",fontSize:32,textBaseline:"middle",textAlign:"center",fillStyle:"#999999"},style:{width:"100%",height:"400rpx",borderRadius:"10rpx",border:"2rpx dashed #cccccc"},ctx:{lineWidth:3,lineCap:"round",lineJoin:"round"},btn:{saveBtn:{content:"保存",order:3},resetBtn:{content:"重签",order:2},cancelBtn:{content:"取消",order:3}}},signatureData:{url:"",tempTime:Date.now()}}),onLoad(t){t.signatureUrl&&(this.signatureData.url=decodeURIComponent(t.signatureUrl))},methods:{handleSignatureUpdate(t){console.log("签名数据更新:",t),this.signatureData={...this.signatureData,...t}},saveSignature(){this.signatureData.url?(this.goBack(),this.uploadSignatureToServer()):m({title:"请先进行签名",icon:"none"})},async uploadSignatureToServer(){try{f({title:"保存中..."});const t=await this.base64ToTempFile(this.signatureData.url),a=await this.uploadFile(t);if(_(),!a.success)throw new Error(a.message||"上传失败");m({title:"签名保存成功",icon:"success"}),setTimeout((()=>{b({delta:1})}),1500)}catch(t){_(),m({title:t.message||"保存失败",icon:"none"}),console.error("保存签名失败:",t)}},uploadFile:t=>new Promise(((a,e)=>{w({url:"YOUR_SERVER_API_URL",filePath:t,name:"signature",formData:{userId:"current_user_id",type:"signature"},success:t=>{try{const e=JSON.parse(t.data);a({success:!0,data:e})}catch(s){e(new Error("服务器响应格式错误"))}},fail:t=>{e(new Error("网络请求失败"))}})})),base64ToTempFile:t=>new Promise(((a,e)=>{const s=t.replace(/^data:image\/\w+;base64,/,""),n=k(s),i=uni.getFileSystemManager(),r=`signature_${Date.now()}.png`,o=`${uni.env.USER_DATA_PATH}/${r}`;i.writeFile({filePath:o,data:n,encoding:"binary",success:()=>a(o),fail:t=>e(t)})})),downloadSignature(){if(!this.signatureData.url)return void m({title:"没有可下载的签名",icon:"none"});const t=document.createElement("a");t.href=this.signatureData.url,t.download=`signature_${Date.now()}.png`,document.body.appendChild(t),t.click(),document.body.removeChild(t)},clearSignature(){y({title:"确认清除",content:"确定要清除当前签名吗？",success:t=>{t.confirm&&(this.signatureData.url="",m({title:"已清除",icon:"success"}))}})},goBack(){b({delta:1})}}},[["render",function(t,a,e,o,l,c){const d=v(C("rn-signature"),x),u=S,p=g;return s(),n(p,{class:"signature-container"},{default:i((()=>[r(d,{options:l.signatureOptions,data:l.signatureData,"onUpdate:data":c.handleSignatureUpdate},null,8,["options","data","onUpdate:data"]),r(p,{class:"action-buttons"},{default:i((()=>[r(u,{onClick:c.saveSignature,class:"save-btn",disabled:!l.signatureData.url},{default:i((()=>[D(" 保存签名 ")])),_:1},8,["onClick","disabled"]),r(u,{onClick:c.goBack,class:"back-btn"},{default:i((()=>[D("返回")])),_:1},8,["onClick"])])),_:1})])),_:1})}],["__scopeId","data-v-e095d0ac"]]);export{A as default};
