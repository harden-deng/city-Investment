import{y as e,r as a,$ as l,z as s,A as t,l as o,p as n,c as u,d as i,w as c,m as r,B as d,C as f,i as p,o as m,e as v,n as _,f as g,D as h,E as b,q as x,t as y,F as k,G as q,s as j,h as C,I as w,H as N,x as F,J as V,K as B,L as R,u as D,v as T}from"./index-vclNGZkt.js";import{_ as P}from"./uni-nav-bar.C4KqgVBC.js";import{o as z,a as G,b as H,c as I,r as A}from"./uni-app.es.C4xkBdw-.js";import{_ as K}from"./z-paging.BYUayfj1.js";import{_ as L}from"./search.ByzXnQub.js";import{g as Q}from"./storage.D9vc3L4u.js";import{h as U}from"./request.BGjJ8WZd.js";import{f as $,a as E}from"./h5Bribge.BpFLbEvQ.js";import{B as J}from"./bottomNavBar.BXd0ouO1.js";import{F as M}from"./filterPopup.Tc-0erPi.js";import{_ as O}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-icons.Cl6Lj6n6.js";import"./uni-popup.DprRcyc1.js";const S=O({__name:"pending",setup(O){e((e=>({"5c4838ae":de.value})));const S=a(0);z((()=>{const e=Q("statusBarHeight");0!=Number(e)&&(S.value=Number(e)),l("refresh-pending",(()=>{ue()}))})),G((()=>{s("refresh-pending")}));const W=a(null),X=a(""),Y=a(0),Z=[{label:"所有",wf:""},{label:"工程类款项",wf:"GC01"},{label:"其他类",wf:"QT01"}],ee=a(Z.map((e=>e.wf))),ae=a(Z.map((e=>e.label))),le=a(null);function se(){var e;null==(e=le.value)||e.open()}function te(e){console.log("筛选结果",e)}function oe(){console.log("重置筛选")}const ne=()=>{q(),ue()},ue=()=>{W.value.reload()},ie=()=>{console.log("下拉刷新触发")},ce=a([]),re=(e,a)=>{U.get("/WF/GetToDoTask",{Page:e,Limit:a,ProcDefId:ee.value[Y.value],RequestFormNo:X.value}).then((e=>{W.value.complete(e.data.data||[])})).catch((()=>{W.value.complete(!1),j({title:"加载失败",icon:"none"})}))};H((()=>{console.log("页面显示，重新计算高度"),t((()=>{fe()}))})),I((()=>{console.log("页面隐藏")}));const de=a(""),fe=()=>{try{const{windowHeight:e}=r(),a=d();f().in(null==a?void 0:a.proxy).select(".header-stickt").boundingClientRect((a=>{const l=(null==a?void 0:a.height)||0,s=Math.max(0,e-l);de.value=`${s}px`})).exec()}catch(e){de.value="calc(100vh - 100rpx)"}};return o((()=>{var e;console.log("订单页面加载完成"),t((()=>fe())),null==(e=n)||e((()=>fe()))})),(e,a)=>{const l=p,s=C,t=w,o=A(u("uni-nav-bar"),P),n=T,r=A(u("z-paging"),K);return m(),i(l,{class:"order-page"},{default:c((()=>[v(l,{class:"header-stickt"},{default:c((()=>[v(l,{class:"status_bar",style:_({height:2*S.value+"rpx"})},null,8,["style"]),v(o,{class:"nav-bar-top"},{left:c((()=>[v(l,{class:"nav-bar-title"},{default:c((()=>[g(" 待办流程 ")])),_:1})])),right:c((()=>[v(l,{onClick:se,class:"nav-bar-filter"},{default:c((()=>[g(" 筛选 ")])),_:1})])),default:c((()=>[v(l,{class:"nav-input-view"},{default:c((()=>[v(s,{class:"input-seach",src:L,mode:"",onClick:h(ne,["stop"])}),v(t,{class:"input-view",placeholder:"搜索",type:"text",modelValue:X.value,"onUpdate:modelValue":a[0]||(a[0]=e=>X.value=e),"confirm-type":"search",onConfirm:ne,onKeyup:b(ne,["enter"])},null,8,["modelValue"])])),_:1})])),_:1}),v(l,{class:"segmented-section"},{default:c((()=>[(m(!0),x(k,null,y(ae.value,((e,a)=>(m(),i(l,{class:"segmented-section-item",key:a,onClick:e=>{return l=a,Y.value=l,ue(),void console.log("切换到:",ae.value[l]);var l}},{default:c((()=>[v(n,{class:"section-item-0",style:{height:"0"}}),v(l,{class:N(["section-item-1",{"section-item-1-active":a===Y.value}])},{default:c((()=>[g(F(e),1)])),_:2},1032,["class"]),v(n,{class:N(["section-item-0",{"section-item-0-active":a===Y.value}])},null,8,["class"])])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1}),v(l,{class:"order-list"},{default:c((()=>[v(r,{ref_key:"paging",ref:W,modelValue:ce.value,"onUpdate:modelValue":a[1]||(a[1]=e=>ce.value=e),onOnRefresh:ie,onQuery:re,fixed:!1},{default:c((()=>[v(l,{style:{height:"30rpx"}}),(m(!0),x(k,null,y(ce.value,(e=>(m(),i(l,{class:"order-card",key:e.id||e.requestFormNo,onClick:a=>(e=>{D({url:"/pages/detail/index",success(a){a.eventChannel.emit("open-detail",{type:"pending",order:e})}})})(e)},{default:c((()=>[V(v(l,{class:"approved-view"},null,512),[[B,"Completed"===(null==e?void 0:e.wfStatus)]]),v(l,{class:"order-header"},{default:c((()=>[v(n,{class:"order-id"},{default:c((()=>[g(F(e.requestFormNo),1)])),_:2},1024),v(l,{class:"order-time"},{default:c((()=>[v(n,{class:"time-text"},{default:c((()=>[g(F(R($)(e.submittedDate)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),v(l,{class:"order-content"},{default:c((()=>[v(l,{class:"quote-section"},{default:c((()=>[v(n,{class:"quote-label"},{default:c((()=>[g("申请费用：")])),_:1}),v(n,{class:"quote-price"},{default:c((()=>[g("¥"+F(R(E)(e.planToPayTotal)||"--"),1)])),_:2},1024)])),_:2},1024),v(l,{class:"quote-section"},{default:c((()=>[v(n,{class:"quote-label"},{default:c((()=>[g("申请单位：")])),_:1}),v(n,{class:"description-text"},{default:c((()=>[g(F(e.procDefName)+" | "+F(e.submittedByName),1)])),_:2},1024)])),_:2},1024),v(l,{class:"quote-section"},{default:c((()=>[v(n,{class:"quote-label"},{default:c((()=>[g("关键信息：")])),_:1}),v(n,{class:"description-text"},{default:c((()=>[g(F(e.taskName),1)])),_:2},1024)])),_:2},1024),v(l,{class:"quote-section"},{default:c((()=>[v(n,{class:"quote-label"},{default:c((()=>[g("业务摘要：")])),_:1}),v(n,{class:"description-text"},{default:c((()=>[g(F(e.stepName),1)])),_:2},1024)])),_:2},1024),v(l,{class:"label-view"},{default:c((()=>[(m(!0),x(k,null,y((null==e?void 0:e.labelArr)||[],((e,a)=>(m(),i(l,{class:"label-item",key:a},{default:c((()=>[v(n,{class:"point-icon"}),v(n,{class:"label-text"},{default:c((()=>[g(F(e.label),1)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1},8,["modelValue"])])),_:1}),v(M,{ref_key:"filterRef",ref:le,onConfirm:te,onReset:oe},null,512),v(J,{ref:"bottomNavRef",modelValueFlag:2},null,512)])),_:1})}}},[["__scopeId","data-v-f6af0c5a"]]);export{S as default};
