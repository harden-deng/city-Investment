import{r as e,m as a,p as t,ad as l,ae as s,a5 as n,l as u,a4 as i,s as o,c,w as d,V as r,i as v,o as g,b as f,n as h,P as m,a3 as p,a7 as y,d as S,v as w,y as x}from"./index-DszEigh-.js";import{_ as I}from"./_plugin-vue_export-helper.BCo6x5W8.js";const _=I({__name:"index",props:{orientation:{type:String,default:"portrait"},canvasId:{type:String,default:"mySign"},width:{type:String,default:""},height:{type:String,default:""},backgroundColor:{type:String,default:"#ececec"},lineColor:{type:String,default:"#333333"},lineSize:{type:String,default:"5rpx"},initialSignature:{type:String,default:""}},emits:["change","confirm"],setup(I,{expose:_,emit:b}){const T=b,k=I,C=e(null),W=e(null),z=e(!1),F=e(0),P=e(0),V=e(5),j=e("");a((()=>k.initialSignature),(e=>{e&&(console.log("newVal",e),E(e))}),{immediate:!0}),t((()=>{V.value=l(parseInt(k.lineSize));let e=s();k.width?F.value=l(parseInt(k.width)):F.value=e.windowWidth,k.height?P.value=l(parseInt(k.height)):P.value=e.windowHeight,setTimeout((()=>{C.value=n(k.canvasId),B(),k.initialSignature&&(console.log("newVal2222",k.initialSignature),E(k.initialSignature))}),300)}));const H=u((()=>({width:F.value+"px",height:P.value+"px"})));function B(){setTimeout((()=>{C.value.setFillStyle(k.backgroundColor),C.value.fillRect(0,0,F.value,P.value),C.value.draw(!0),C.value.setStrokeStyle(k.lineColor),C.value.setLineWidth(V.value),z.value=!1,j.value=""}),100)}function E(e){var a;e&&(e.startsWith("data:image/")?function(e){console.log("loadBase64Image",e);const a=new Image;a.onload=()=>{C.value.drawImage(a,0,0,F.value,P.value),C.value.draw(!0),j.value=e,z.value=!0},a.src=e}(e):(a=e,console.log("loadImageFromPath",a),i({src:a,success:e=>{C.value.drawImage(e.path,0,0,F.value,P.value),C.value.draw(!0),j.value=a,z.value=!0},fail:e=>{console.error("加载签名图片失败:",e),o({title:"加载签名失败",icon:"none"})}})))}function L(e){let a=e.touches[0].x,t=e.touches[0].y;C.value.moveTo(a,t)}function R(e){let a=e.touches[0].x,t=e.touches[0].y;C.value.lineTo(a,t),C.value.stroke(),C.value.draw(!0,function(){z.value=!0,null!=W.value&&clearTimeout(W.value);W.value=setTimeout((()=>{p({x:0,y:0,width:F.value,height:P.value,destWidth:F.value,destHeight:P.value,canvasId:k.canvasId,success:e=>{console.log("saveImg",e),j.value=e.tempFilePath,T("change",e)}})}),300)}()),C.value.moveTo(a,t)}function $(){z.value?(T("confirm",j.value),r()):o({title:"请先进行签名",icon:"none"})}return _({confirm:$,canvasInit:B,loadExistingSignature:E}),(e,a)=>{const t=y,l=v,s=x;return g(),c(l,{class:"zx-sign"},{default:d((()=>[f(l,{class:"canvas-box"},{default:d((()=>[f(l,{style:h(H.value)},{default:d((()=>[f(t,{id:I.canvasId,"canvas-id":I.canvasId,style:h(H.value),onTouchstart:L,onTouchmove:R},null,8,["id","canvas-id","style"])])),_:1},8,["style"]),m(e.$slots,"actions",{},(()=>[f(l,{class:"sign-actions-default"},{default:d((()=>[f(l,{class:"sign-desc",style:h({bottom:.4*P.value+"px"})},{default:d((()=>[f(s,{class:"rotated-desc"},{default:d((()=>[S("请在下方手写签名")])),_:1})])),_:1},8,["style"]),f(l,{class:w(["sign-button",{disabled:!z.value}]),onClick:$},{default:d((()=>[f(s,{class:"rotated-text",style:h({backgroundColor:z.value?"#19be6b":"#71d5a1"})},{default:d((()=>[S("确认签名")])),_:1},8,["style"])])),_:1},8,["class"]),f(l,{class:"re-button",onClick:B},{default:d((()=>[f(s,{class:"rotated-text",style:{"background-color":"#ff9900"}},{default:d((()=>[S("重新签名")])),_:1})])),_:1})])),_:1})]),!0)])),_:3})])),_:3})}}},[["__scopeId","data-v-31d45cda"]]);export{_ as default};
