import{r as e,W as a,l as t,ac as l,ad as s,a4 as n,k as u,a3 as i,s as o,d as c,w as d,V as r,i as v,o as g,e as f,n as h,O as m,a2 as p,a6 as y,f as S,H as w,v as x}from"./index-vclNGZkt.js";import{_ as I}from"./_plugin-vue_export-helper.BCo6x5W8.js";const _=I({__name:"index",props:{orientation:{type:String,default:"portrait"},canvasId:{type:String,default:"mySign"},width:{type:String,default:""},height:{type:String,default:""},backgroundColor:{type:String,default:"#ececec"},lineColor:{type:String,default:"#333333"},lineSize:{type:String,default:"5rpx"},initialSignature:{type:String,default:""}},emits:["change","confirm"],setup(I,{expose:_,emit:b}){const k=b,T=I,C=e(null),W=e(null),z=e(!1),F=e(0),H=e(0),V=e(5),j=e("");a((()=>T.initialSignature),(e=>{e&&(console.log("newVal",e),E(e))}),{immediate:!0}),t((()=>{V.value=l(parseInt(T.lineSize));let e=s();T.width?F.value=l(parseInt(T.width)):F.value=e.windowWidth,T.height?H.value=l(parseInt(T.height)):H.value=e.windowHeight,setTimeout((()=>{C.value=n(T.canvasId),B(),T.initialSignature&&(console.log("newVal2222",T.initialSignature),E(T.initialSignature))}),300)}));const P=u((()=>({width:F.value+"px",height:H.value+"px"})));function B(){setTimeout((()=>{C.value.setFillStyle(T.backgroundColor),C.value.fillRect(0,0,F.value,H.value),C.value.draw(!0),C.value.setStrokeStyle(T.lineColor),C.value.setLineWidth(V.value),z.value=!1,j.value=""}),100)}function E(e){var a;e&&(e.startsWith("data:image/")?function(e){console.log("loadBase64Image",e);const a=new Image;a.onload=()=>{C.value.drawImage(a,0,0,F.value,H.value),C.value.draw(!0),j.value=e,z.value=!0},a.src=e}(e):(a=e,console.log("loadImageFromPath",a),i({src:a,success:e=>{C.value.drawImage(e.path,0,0,F.value,H.value),C.value.draw(!0),j.value=a,z.value=!0},fail:e=>{console.error("加载签名图片失败:",e),o({title:"加载签名失败",icon:"none"})}})))}function L(e){let a=e.touches[0].x,t=e.touches[0].y;C.value.moveTo(a,t)}function O(e){let a=e.touches[0].x,t=e.touches[0].y;C.value.lineTo(a,t),C.value.stroke(),C.value.draw(!0,function(){z.value=!0,null!=W.value&&clearTimeout(W.value);W.value=setTimeout((()=>{p({x:0,y:0,width:F.value,height:H.value,destWidth:F.value,destHeight:H.value,canvasId:T.canvasId,success:e=>{console.log("saveImg",e),j.value=e.tempFilePath,k("change",e)}})}),300)}()),C.value.moveTo(a,t)}function R(){z.value?(k("confirm",j.value),r()):o({title:"请先进行签名",icon:"none"})}return _({confirm:R,canvasInit:B,loadExistingSignature:E}),(e,a)=>{const t=y,l=v,s=x;return g(),c(l,{class:"zx-sign"},{default:d((()=>[f(l,{class:"canvas-box"},{default:d((()=>[f(l,{style:h(P.value)},{default:d((()=>[f(t,{id:I.canvasId,"canvas-id":I.canvasId,style:h(P.value),onTouchstart:L,onTouchmove:O},null,8,["id","canvas-id","style"])])),_:1},8,["style"]),m(e.$slots,"actions",{},(()=>[f(l,{class:"sign-actions-default"},{default:d((()=>[f(l,{class:"sign-desc",style:h({bottom:.4*H.value+"px"})},{default:d((()=>[f(s,{class:"rotated-desc"},{default:d((()=>[S("请在下方手写签名")])),_:1})])),_:1},8,["style"]),f(l,{class:w(["sign-button",{disabled:!z.value}]),onClick:R},{default:d((()=>[f(s,{class:"rotated-text",style:h({backgroundColor:z.value?"#19be6b":"#71d5a1"})},{default:d((()=>[S("确认签名")])),_:1},8,["style"])])),_:1},8,["class"]),f(l,{class:"re-button",onClick:B},{default:d((()=>[f(s,{class:"rotated-text",style:{"background-color":"#ff9900"}},{default:d((()=>[S("重新签名")])),_:1})])),_:1})])),_:1})]),!0)])),_:3})])),_:3})}}},[["__scopeId","data-v-31d45cda"]]);export{_ as default};
