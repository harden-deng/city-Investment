import{u as a,W as e,R as l,r as t,l as s,D as u,c,w as n,E as o,i,o as f,b as d,d as r,x as v,v as p,q as m,t as _,F as b,J as k,K as y,X as h,Q as g,y as C,S as w}from"./index-DszEigh-.js";import{o as N}from"./uni-app.es.yxr7YjqI.js";import{F as j,A as x,P as D,b as I,c as R,a as T,d as q}from"./uni-popup.C2LCYpza.js";import{h as E}from"./request.CCTae_dV.js";import{u as A,a as U,d as B,b as F,c as L,I as z}from"./attachmentList.DtrauFz4.js";import{_ as M}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-nav-bar.CQxrnHAm.js";import"./uni-icons.Bqff-X7n.js";import"./uni-easyinput.BqZ0_ocZ.js";const P=M({__name:"fyzz",setup(M){let P;a((a=>({c8b86e56:o(Q)})));let S=null;N((()=>{var a,l,t;P=null==(t=null==(l=null==(a=e())?void 0:a.proxy)?void 0:l.getOpenerEventChannel)?void 0:t.call(l),S=a=>{G.value=a.type,H.value=a.order,da(),ta()},P.on("open-detail",S)})),l((()=>{P&&S&&P.off("open-detail",S),S=null}));const G=t(""),H=t({}),J=t([]),K=s((()=>"Running"==fa.value.wfstatus?"流转中":"Completed"==fa.value.wfstatus?"已审批":"")),O=t([]),{listHeight:Q}=A({headerSelector:".header-stickt",iosFit:!0}),{inputDialogRef:W,inputDialogRequired:X,inputDialogTitle:V,inputDialogPlaceholder:Y,handleInputConfirm:Z,handleInputCancel:$,onReject:aa,onApprove:ea,approvalRecordList:la,getApprovalRecord:ta}=U({itemDetail:H,currentType:G,successMessage:"已审批",autoGoBack:!0,autoRefresh:!0}),sa=u({[j]:!0,[x]:!0,[D]:!0,[I]:!0}),ua=a=>{sa[a]=!sa[a]},ca=a=>sa[a],na=s((()=>({pending:{procCode:H.value.procDefCode,workitemid:H.value.workItemId},completed:{procCode:H.value.procDefCode,wfInstanceId:H.value.wfinstanceId}}[G.value]))),oa=t([{label:"申请人",value:"",key:"applicantName"},{label:"用款部门",value:"",key:"businessUnitName"}]),ia=t([{label:"付款单位",value:"",key:"paymentCompanyName"},{label:"收款名称",value:"",key:"receivingBankAccountName"},{label:"开户银行",value:"",key:"receivingBankName"},{label:"帐号",value:"",key:"receivingBankAccountNumber"},{label:"预算栏目",value:"",key:"claimCategoryName"},{label:"暂支事由",value:"",key:"content"},{label:"暂支金额",value:"",key:"amount"}]),fa=t({}),da=()=>{E.get(R[G.value],na.value).then((a=>{var e;let l=(null==(e=a.data)?void 0:e.data)||{};fa.value=l.entity||{},oa.value.forEach((a=>{a.value="number"==typeof fa.value[a.key]?T(fa.value[a.key]):fa.value[a.key]||""})),ia.value.forEach((a=>{a.value="number"==typeof fa.value[a.key]?T(fa.value[a.key]):fa.value[a.key]||""})),fa.value.businessUnitName&&J.value.push(fa.value.businessUnitName),fa.value.submittedDate&&J.value.push(q(fa.value.submittedDate));let t=(l.attachmentList||[]).map((a=>({fileTagName:a.fileTagName,fileName:a.fileName,fileUrl:a.fileUrl,id:a.attachmentId})));O.value=[{fileTagName:"其他",children:[]},{fileTagName:"签报或会议通知",children:[]}];const s=new Map;O.value.forEach((a=>{s.set(a.fileTagName,a)})),t.forEach((a=>{const e=s.get(a.fileTagName);e&&e.children.push(a)}))}))};return(a,e)=>{const l=i,t=C,s=w;return f(),c(l,{class:"detail-page"},{default:n((()=>[d(l,{class:"header-stickt"},{default:n((()=>[d(B),d(l,{class:"hero-card"},{default:n((()=>[d(l,{class:"hero-header"},{default:n((()=>[d(l,{class:"project-name"},{default:n((()=>[d(l,{class:"project-name-1"},{default:n((()=>[r(v(H.value.taskName||"费用暂支单申请"),1)])),_:1}),d(l,{class:"project-name-1"},{default:n((()=>[r(v(fa.value.paymentCompanyName),1)])),_:1})])),_:1}),d(l,{class:"amount-box"},{default:n((()=>[d(l,{class:"amount-label"},{default:n((()=>[r("暂支金额")])),_:1}),d(l,{class:"amount-value"},{default:n((()=>[d(t,{class:"amount-value-symbol"},{default:n((()=>[r("¥")])),_:1}),d(t,{class:"amount-value-number"},{default:n((()=>[r(v(o(T)(fa.value.amount)),1)])),_:1})])),_:1})])),_:1})])),_:1}),d(l,{class:p(["hero-tags",{"hero-tags-width":"pending"!=G.value}])},{default:n((()=>[(f(!0),m(b,null,_(J.value,((a,e)=>(f(),c(l,{class:"tag",key:e},{default:n((()=>[r(v(a),1)])),_:2},1024)))),128))])),_:1},8,["class"]),k(d(l,{class:"hero-actions"},{default:n((()=>[d(l,{class:"btn outline",onClick:o(aa)},{default:n((()=>[r("打回")])),_:1},8,["onClick"]),d(l,{class:"btn primary",onClick:o(ea)},{default:n((()=>[r("通过")])),_:1},8,["onClick"])])),_:1},512),[[y,"pending"===G.value]]),k(d(l,{class:"wfstatus-actions"},{default:n((()=>[r(v(K.value),1)])),_:1},512),[[y,"completed"===G.value&&("Running"==fa.value.wfstatus||"Completed"==fa.value.wfstatus)]])])),_:1})])),_:1}),d(s,{"scroll-y":"true",class:"scroller"},{default:n((()=>[d(l,{class:"section"},{default:n((()=>[d(l,{class:"section-title"},{default:n((()=>[d(t,{class:"section-title-vertical"}),d(t,{class:"section-title-text"},{default:n((()=>[r("基本信息")])),_:1})])),_:1}),d(l,{class:"info-list"},{default:n((()=>[(f(!0),m(b,null,_(oa.value,((a,e)=>(f(),c(l,{class:"info-item",key:e},{default:n((()=>[d(t,{class:"info-label"},{default:n((()=>[r(v(a.label),1)])),_:2},1024),d(t,{class:"info-value"},{default:n((()=>[r(v(a.value||"--"),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1}),d(l,{class:"section"},{default:n((()=>[d(l,{class:"section-title-2",onClick:e[0]||(e[0]=a=>ua(o(D)))},{default:n((()=>[d(l,{class:"section-title-2-left"},{default:n((()=>[d(t,{class:"section-title-vertical"}),d(t,{class:"section-title-text"},{default:n((()=>[r("暂支内容")])),_:1})])),_:1}),d(l,{class:p(["section-title-2-right",{active:ca(o(D))}])},null,8,["class"])])),_:1}),d(h,{name:"collapse"},{default:n((()=>[ca(o(D))?(f(),c(l,{key:0,class:"account-info-section"},{default:n((()=>[d(l,{class:"account-card"},{default:n((()=>[d(l,{class:"account-info-block"},{default:n((()=>[d(l,{class:"account-info-row"},{default:n((()=>[d(t,{class:"account-info-label"},{default:n((()=>[r(v(ia.value[0].label),1)])),_:1}),d(t,{class:"account-info-value"},{default:n((()=>[r(v(ia.value[0].value||""),1)])),_:1})])),_:1})])),_:1}),d(l,{class:"account-info-block",style:{"margin-top":"20rpx"}},{default:n((()=>[d(l,{class:"account-info-row"},{default:n((()=>[d(t,{class:"account-info-label"},{default:n((()=>[r(v(ia.value[1].label),1)])),_:1}),d(t,{class:"account-info-value"},{default:n((()=>[r(v(ia.value[1].value||""),1)])),_:1})])),_:1}),d(l,{class:"account-info-row"},{default:n((()=>[d(t,{class:"account-info-label"},{default:n((()=>[r(v(ia.value[2].label),1)])),_:1}),d(t,{class:"account-info-value"},{default:n((()=>[r(v(ia.value[2].value||""),1)])),_:1})])),_:1}),d(l,{class:"account-info-row"},{default:n((()=>[d(t,{class:"account-info-label"},{default:n((()=>[r(v(ia.value[3].label),1)])),_:1}),d(t,{class:"account-info-value"},{default:n((()=>[r(v(ia.value[3].value||""),1)])),_:1})])),_:1})])),_:1}),d(l,{class:"account-info-block",style:{"margin-top":"20rpx"}},{default:n((()=>[d(l,{class:"account-info-row"},{default:n((()=>[d(t,{class:"account-info-label"},{default:n((()=>[r(v(ia.value[4].label),1)])),_:1}),d(t,{class:"account-info-value"},{default:n((()=>[r(v(ia.value[4].value||""),1)])),_:1})])),_:1}),d(l,{class:"account-info-row"},{default:n((()=>[d(t,{class:"account-info-label"},{default:n((()=>[r(v(ia.value[5].label),1)])),_:1}),d(t,{class:"account-info-value"},{default:n((()=>[r(v(ia.value[5].value||""),1)])),_:1})])),_:1}),d(l,{class:"account-info-row"},{default:n((()=>[d(t,{class:"account-info-label"},{default:n((()=>[r(v(ia.value[6].label),1)])),_:1}),d(t,{class:"account-info-value"},{default:n((()=>[r(v(ia.value[6].value||""),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):g("",!0)])),_:1})])),_:1}),d(l,{class:"section"},{default:n((()=>[d(l,{class:"section-title-2",onClick:e[1]||(e[1]=a=>ua(o(I)))},{default:n((()=>[d(l,{class:"section-title-2-left"},{default:n((()=>[d(t,{class:"section-title-vertical"}),d(t,{class:"section-title-text"},{default:n((()=>[r("附件")])),_:1})])),_:1}),d(l,{class:p(["section-title-2-right",{active:ca(o(I))}])},null,8,["class"])])),_:1}),d(h,{name:"collapse"},{default:n((()=>[ca(o(I))?(f(),c(l,{key:0,class:"attachment-section"},{default:n((()=>[d(F,{list:O.value},null,8,["list"])])),_:1})):g("",!0)])),_:1})])),_:1}),d(l,{class:"section"},{default:n((()=>[d(l,{class:"section-title-2",onClick:e[2]||(e[2]=a=>ua(o(x)))},{default:n((()=>[d(l,{class:"section-title-2-left"},{default:n((()=>[d(t,{class:"section-title-vertical"}),d(t,{class:"section-title-text"},{default:n((()=>[r("审批记录")])),_:1})])),_:1}),d(l,{class:p(["section-title-2-right",{active:ca(o(x))}])},null,8,["class"])])),_:1}),d(h,{name:"collapse"},{default:n((()=>[ca(o(x))?(f(),c(l,{key:0,class:"approval-record-section"},{default:n((()=>[d(L,{list:o(la)},null,8,["list"])])),_:1})):g("",!0)])),_:1})])),_:1})])),_:1}),d(z,{ref_key:"inputDialogRef",ref:W,required:o(X),title:o(V),placeholder:o(Y),onConfirm:o(Z),onCancel:o($)},null,8,["required","title","placeholder","onConfirm","onCancel"])])),_:1})}}},[["__scopeId","data-v-de8b5d44"]]);export{P as default};
