import{u as e,W as a,R as l,r as t,l as u,D as c,c as s,w as o,E as n,i,o as f,b as v,d,x as r,v as _,q as m,t as y,F as b,J as p,K as k,X as h,Q as g,y as w,S as C}from"./index-DszEigh-.js";import{o as A}from"./uni-app.es.yxr7YjqI.js";import{F as R,A as N,P as x,b as I,c as T,a as j,d as D}from"./uni-popup.C2LCYpza.js";import{h as q}from"./request.CCTae_dV.js";import{u as E,a as V,d as U,b as F,c as L,I as P}from"./attachmentList.DtrauFz4.js";import{_ as B}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-nav-bar.CQxrnHAm.js";import"./uni-icons.Bqff-X7n.js";import"./uni-easyinput.BqZ0_ocZ.js";const M=B({__name:"srqr",setup(B){let M;e((e=>({d766a654:n(Q)})));let S=null;A((()=>{var e,l,t;M=null==(t=null==(l=null==(e=a())?void 0:e.proxy)?void 0:l.getOpenerEventChannel)?void 0:t.call(l),S=e=>{G.value=e.type,H.value=e.order,re(),te()},M.on("open-detail",S)})),l((()=>{M&&S&&M.off("open-detail",S),S=null}));const G=t(""),H=t({}),J=t([]),K=u((()=>"Running"==ve.value.wfstatus?"流转中":"Completed"==ve.value.wfstatus?"已审批":"")),O=t([]),{listHeight:Q}=E({headerSelector:".header-stickt",iosFit:!0}),{inputDialogRef:W,inputDialogRequired:X,inputDialogTitle:z,inputDialogPlaceholder:Y,handleInputConfirm:Z,handleInputCancel:$,onReject:ee,onApprove:ae,approvalRecordList:le,getApprovalRecord:te}=V({itemDetail:H,currentType:G,successMessage:"已审批",autoGoBack:!0,autoRefresh:!0}),ue=c({[R]:!0,[N]:!0,[x]:!0,[I]:!0}),ce=e=>{ue[e]=!ue[e]},se=e=>ue[e],oe=u((()=>({pending:{procCode:H.value.procDefCode,workitemid:H.value.workItemId},completed:{procCode:H.value.procDefCode,wfInstanceId:H.value.wfinstanceId}}[G.value]))),ne=t([{label:"类型",value:"",key:"requestType"},{label:"合同名称",value:"",key:"contractName"},{label:"合同子项",value:"",key:"relatedContractItemName"},{label:"合同金额 (含税)",value:"",key:"contractAmountVat"},{label:"内容",value:"",key:"content"}]),ie=t([{label:"本期确认含税金额",value:"",key:"confirmedIncomeAmountVat"},{label:"本期确认不含税金额",value:"",key:"confirmedIncomeAmountNet"},{label:"本期收入量占比同比",value:"",key:"contractRatio"},{label:"增值税税额",value:"",key:"confirmedIncomeTaxAmount"},{label:"累计确认金额 (含税)",value:"",key:"accuredConfirmedIncomeAmountVat"},{label:"确认日期",value:"",key:"confirmedDate"},{label:"确认依据",value:"",key:"remark"}]),fe=t([{label:"开票单位",value:"",key:"receiverCompany"},{label:"付款单位",value:"",key:"paymentAccountName"},{label:"申请开票分类",value:"",key:"invoiceType"},{label:"开户行",value:"",key:"paymentBankName"},{label:"账号",value:"",key:"paymentAccountNumber"},{label:"税号",value:"",key:"paymentTaxNumber"},{label:"地址",value:"",key:"registrationAddress"},{label:"电话",value:"",key:"registrationPhone"},{label:"发票含税金额",value:"",key:"planToReceive"},{label:"款项是否已经到账",value:"",key:"isAlreadyReceived"},{label:"开票备注",value:"",key:"invoiceAmount"}]),ve=t({}),de=c({IncomeConfirm:"收入确认",Invoicing:"申请开票"}),re=()=>{q.get(T[G.value],oe.value).then((e=>{var a,l;let t=(null==(a=e.data)?void 0:a.data)||{};if(ve.value=t||{},ne.value.forEach((e=>{if(e.value="number"==typeof ve.value[e.key]?j(ve.value[e.key]):ve.value[e.key],"requestType"==e.key&&ve.value[e.key]){let a="";ve.value[e.key].split("|").forEach((e=>{a+=de[e]+"、"})),e.value=a.slice(0,-1)||""}})),ie.value.forEach((e=>{e.value="number"==typeof ve.value[e.key]&&"contractRatio"!=e.key?j(ve.value[e.key]):ve.value[e.key],"contractRatio"==e.key&&(e.value=ve.value[e.key]+"%"||""),"confirmedDate"==e.key&&(e.value=D(ve.value[e.key])||"")})),ve.value.isAlreadyReceived&&[1].includes(ve.value.isAlreadyReceived)){let e={label:"到账金额",value:"",key:"receivedAmountVat"};fe.value.splice(fe.value.length-1,0,e);let a={label:"到账时间",value:"",key:"receivedDate"};fe.value.splice(fe.value.length-1,0,a)}fe.value.forEach((e=>{e.value="number"==typeof ve.value[e.key]&&"isAlreadyReceived"!=e.key?j(ve.value[e.key]):ve.value[e.key],"isAlreadyReceived"==e.key&&[0,1].includes(ve.value[e.key])&&(e.value=0==ve.value[e.key]?"否":"是"),"receivedDate"==e.key&&(e.value=D(ve.value[e.key])||"")})),ve.value.businessUnitName&&J.value.push(ve.value.businessUnitName),ne.value[0].value&&J.value.push(ne.value[0].value);let u=((null==(l=ve.value)?void 0:l.attachmentList)||[]).map((e=>({fileTagName:e.fileTagName,fileName:e.fileName,fileUrl:e.fileUrl,id:e.attachmentId})));O.value=[{fileTagName:"合同",children:[]},{fileTagName:"合同要求其他资料",children:[]},{fileTagName:"其他",children:[]}];const c=new Map;O.value.forEach((e=>{c.set(e.fileTagName,e)})),u.forEach((e=>{const a=c.get(e.fileTagName);a&&a.children.push(e)}))}))};return(e,a)=>{const l=i,t=w,u=C;return f(),s(l,{class:"detail-page"},{default:o((()=>[v(l,{class:"header-stickt"},{default:o((()=>[v(U),v(l,{class:"hero-card"},{default:o((()=>[v(l,{class:"hero-header"},{default:o((()=>[v(l,{class:"project-name"},{default:o((()=>[v(l,{class:"project-name-1"},{default:o((()=>[d(r(H.value.taskName),1)])),_:1}),ne.value[0].value.includes("收入确认")&&ne.value[0].value.includes("申请开票")?(f(),s(l,{key:0,class:"amount-value"},{default:o((()=>[v(t,{class:"amount-value-symbol"},{default:o((()=>[d("确认金额:")])),_:1}),v(t,{class:"amount-value-symbol"},{default:o((()=>[d("¥")])),_:1}),v(t,{class:"amount-value-number"},{default:o((()=>[d(r(n(j)(ve.value.confirmedIncomeAmountVat)),1)])),_:1})])),_:1})):(f(),s(l,{key:1,class:"project-name-1"},{default:o((()=>[d(r(ve.value.contractName),1)])),_:1}))])),_:1}),v(l,{class:"amount-box"},{default:o((()=>[v(l,{class:"amount-label"},{default:o((()=>[d("申请金额")])),_:1}),ne.value[0].value.includes("申请开票")?(f(),s(l,{key:0,class:"amount-value",style:{"justify-content":"flex-end"}},{default:o((()=>[v(t,{class:"amount-value-symbol"},{default:o((()=>[d("发票金额:")])),_:1}),v(t,{class:"amount-value-symbol"},{default:o((()=>[d("¥")])),_:1}),v(t,{class:"amount-value-number"},{default:o((()=>[d(r(n(j)(ve.value.planToReceive)),1)])),_:1})])),_:1})):(f(),s(l,{key:1,class:"amount-value",style:{"justify-content":"flex-end"}},{default:o((()=>[v(t,{class:"amount-value-symbol"},{default:o((()=>[d("确认金额:")])),_:1}),v(t,{class:"amount-value-symbol"},{default:o((()=>[d("¥")])),_:1}),v(t,{class:"amount-value-number"},{default:o((()=>[d(r(n(j)(ve.value.confirmedIncomeAmountVat)),1)])),_:1})])),_:1}))])),_:1})])),_:1}),v(l,{class:_(["hero-tags",{"hero-tags-width":"pending"!=G.value}])},{default:o((()=>[(f(!0),m(b,null,y(J.value,((e,a)=>(f(),s(l,{class:"tag",key:a},{default:o((()=>[d(r(e),1)])),_:2},1024)))),128))])),_:1},8,["class"]),p(v(l,{class:"hero-actions"},{default:o((()=>[v(l,{class:"btn outline",onClick:n(ee)},{default:o((()=>[d("打回")])),_:1},8,["onClick"]),v(l,{class:"btn primary",onClick:n(ae)},{default:o((()=>[d("通过")])),_:1},8,["onClick"])])),_:1},512),[[k,"pending"===G.value]]),p(v(l,{class:"wfstatus-actions"},{default:o((()=>[d(r(K.value),1)])),_:1},512),[[k,"completed"===G.value&&("Running"==ve.value.wfstatus||"Completed"==ve.value.wfstatus)]])])),_:1})])),_:1}),v(u,{"scroll-y":"true",class:"scroller"},{default:o((()=>[v(l,{class:"section"},{default:o((()=>[v(l,{class:"section-title"},{default:o((()=>[v(t,{class:"section-title-vertical"}),v(t,{class:"section-title-text"},{default:o((()=>[d("基本信息")])),_:1})])),_:1}),v(l,{class:"info-list"},{default:o((()=>[(f(!0),m(b,null,y(ne.value,((e,a)=>(f(),s(l,{class:_(["info-item",{"info-item-border":"contractAmountVat"===e.key}]),key:a},{default:o((()=>[v(t,{class:"info-label"},{default:o((()=>[d(r(e.label),1)])),_:2},1024),v(t,{class:"info-value"},{default:o((()=>[d(r(e.value||"--"),1)])),_:2},1024)])),_:2},1032,["class"])))),128))])),_:1})])),_:1}),ne.value[0].value.includes("收入确认")?(f(),s(l,{key:0,class:"section"},{default:o((()=>[v(l,{class:"section-title-2",onClick:a[0]||(a[0]=e=>ce(n(R)))},{default:o((()=>[v(l,{class:"section-title-2-left"},{default:o((()=>[v(t,{class:"section-title-vertical"}),v(t,{class:"section-title-text"},{default:o((()=>[d("收入确认")])),_:1})])),_:1}),v(l,{class:_(["section-title-2-right",{active:se(n(R))}])},null,8,["class"])])),_:1}),v(h,{name:"collapse"},{default:o((()=>[se(n(R))?(f(),s(l,{key:0,class:"account-info-section"},{default:o((()=>[v(l,{class:"account-card"},{default:o((()=>[v(l,{class:"account-info-block"},{default:o((()=>[v(l,{class:"account-info-row"},{default:o((()=>[v(t,{class:"account-info-label"},{default:o((()=>[d(r(ie.value[0].label),1)])),_:1}),v(t,{class:"account-info-value"},{default:o((()=>[d(r(ie.value[0].value||""),1)])),_:1})])),_:1}),v(l,{class:"account-info-row"},{default:o((()=>[v(t,{class:"account-info-label"},{default:o((()=>[d(r(ie.value[1].label),1)])),_:1}),v(t,{class:"account-info-value"},{default:o((()=>[d(r(ie.value[1].value||""),1)])),_:1})])),_:1}),v(l,{class:"account-info-row"},{default:o((()=>[v(t,{class:"account-info-label"},{default:o((()=>[d(r(ie.value[2].label),1)])),_:1}),v(t,{class:"account-info-value"},{default:o((()=>[d(r(ie.value[2].value||""),1)])),_:1})])),_:1})])),_:1}),v(l,{class:"account-info-block",style:{"margin-top":"20rpx"}},{default:o((()=>[v(l,{class:"account-info-row"},{default:o((()=>[v(t,{class:"account-info-label"},{default:o((()=>[d(r(ie.value[3].label),1)])),_:1}),v(t,{class:"account-info-value"},{default:o((()=>[d(r(ie.value[3].value||""),1)])),_:1})])),_:1}),v(l,{class:"account-info-row"},{default:o((()=>[v(t,{class:"account-info-label"},{default:o((()=>[d(r(ie.value[4].label),1)])),_:1}),v(t,{class:"account-info-value"},{default:o((()=>[d(r(ie.value[4].value||""),1)])),_:1})])),_:1})])),_:1}),v(l,{class:"account-info-block",style:{"margin-top":"20rpx"}},{default:o((()=>[v(l,{class:"account-info-row"},{default:o((()=>[v(t,{class:"account-info-label"},{default:o((()=>[d(r(ie.value[5].label),1)])),_:1}),v(t,{class:"account-info-value"},{default:o((()=>[d(r(ie.value[5].value||""),1)])),_:1})])),_:1}),v(l,{class:"account-info-row"},{default:o((()=>[v(t,{class:"account-info-label"},{default:o((()=>[d(r(ie.value[6].label),1)])),_:1}),v(t,{class:"account-info-value"},{default:o((()=>[d(r(ie.value[6].value||""),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):g("",!0)])),_:1})])),_:1})):g("",!0),ne.value[0].value.includes("申请开票")?(f(),s(l,{key:1,class:"section"},{default:o((()=>[v(l,{class:"section-title-2",onClick:a[1]||(a[1]=e=>ce(n(x)))},{default:o((()=>[v(l,{class:"section-title-2-left"},{default:o((()=>[v(t,{class:"section-title-vertical"}),v(t,{class:"section-title-text"},{default:o((()=>[d("申请开票")])),_:1})])),_:1}),v(l,{class:_(["section-title-2-right",{active:se(n(x))}])},null,8,["class"])])),_:1}),v(h,{name:"collapse"},{default:o((()=>[se(n(x))?(f(),s(l,{key:0,class:"account-info-section"},{default:o((()=>[v(l,{class:"account-card"},{default:o((()=>[v(l,{class:"account-info-block"},{default:o((()=>[v(l,{class:"account-info-row"},{default:o((()=>[v(t,{class:"account-info-label"},{default:o((()=>[d(r(fe.value[0].label),1)])),_:1}),v(t,{class:"account-info-value"},{default:o((()=>[d(r(fe.value[0].value||""),1)])),_:1})])),_:1}),v(l,{class:"account-info-row"},{default:o((()=>[v(t,{class:"account-info-label"},{default:o((()=>[d(r(fe.value[1].label),1)])),_:1}),v(t,{class:"account-info-value"},{default:o((()=>[d(r(fe.value[1].value||""),1)])),_:1})])),_:1}),v(l,{class:"account-info-row"},{default:o((()=>[v(t,{class:"account-info-label"},{default:o((()=>[d(r(fe.value[2].label),1)])),_:1}),v(t,{class:"account-info-value"},{default:o((()=>[d(r(fe.value[2].value||""),1)])),_:1})])),_:1})])),_:1}),v(l,{class:"account-info-block",style:{"margin-top":"20rpx"}},{default:o((()=>[v(l,{class:"account-info-row"},{default:o((()=>[v(t,{class:"account-info-label"},{default:o((()=>[d(r(fe.value[3].label),1)])),_:1}),v(t,{class:"account-info-value"},{default:o((()=>[d(r(fe.value[3].value||""),1)])),_:1})])),_:1}),v(l,{class:"account-info-row"},{default:o((()=>[v(t,{class:"account-info-label"},{default:o((()=>[d(r(fe.value[4].label),1)])),_:1}),v(t,{class:"account-info-value"},{default:o((()=>[d(r(fe.value[4].value||""),1)])),_:1})])),_:1}),v(l,{class:"account-info-row"},{default:o((()=>[v(t,{class:"account-info-label"},{default:o((()=>[d(r(fe.value[5].label),1)])),_:1}),v(t,{class:"account-info-value"},{default:o((()=>[d(r(fe.value[5].value||""),1)])),_:1})])),_:1}),v(l,{class:"account-info-row"},{default:o((()=>[v(t,{class:"account-info-label"},{default:o((()=>[d(r(fe.value[6].label),1)])),_:1}),v(t,{class:"account-info-value"},{default:o((()=>[d(r(fe.value[6].value||""),1)])),_:1})])),_:1}),v(l,{class:"account-info-row"},{default:o((()=>[v(t,{class:"account-info-label"},{default:o((()=>[d(r(fe.value[7].label),1)])),_:1}),v(t,{class:"account-info-value"},{default:o((()=>[d(r(fe.value[7].value||""),1)])),_:1})])),_:1}),v(l,{class:"account-info-row"},{default:o((()=>[v(t,{class:"account-info-label"},{default:o((()=>[d(r(fe.value[8].label),1)])),_:1}),v(t,{class:"account-info-value"},{default:o((()=>[d(r(fe.value[8].value||""),1)])),_:1})])),_:1})])),_:1}),v(l,{class:"account-info-block",style:{"margin-top":"20rpx"}},{default:o((()=>[v(l,{class:"account-info-row"},{default:o((()=>[v(t,{class:"account-info-label"},{default:o((()=>[d(r(fe.value[9].label),1)])),_:1}),v(t,{class:"account-info-value"},{default:o((()=>[d(r(fe.value[9].value||""),1)])),_:1})])),_:1}),1==ve.value.isAlreadyReceived?(f(),s(l,{key:0,class:"account-info-row"},{default:o((()=>[v(t,{class:"account-info-label"},{default:o((()=>[d(r(fe.value[10].label),1)])),_:1}),v(t,{class:"account-info-value"},{default:o((()=>[d(r(fe.value[10].value||""),1)])),_:1})])),_:1})):g("",!0),1==ve.value.isAlreadyReceived?(f(),s(l,{key:1,class:"account-info-row"},{default:o((()=>[v(t,{class:"account-info-label"},{default:o((()=>[d(r(fe.value[11].label),1)])),_:1}),v(t,{class:"account-info-value"},{default:o((()=>[d(r(fe.value[11].value||""),1)])),_:1})])),_:1})):g("",!0),v(l,{class:"account-info-row"},{default:o((()=>[v(t,{class:"account-info-label"},{default:o((()=>[d(r(fe.value[fe.value.length-1].label),1)])),_:1}),v(t,{class:"account-info-value"},{default:o((()=>[d(r(fe.value[fe.value.length-1].value||""),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):g("",!0)])),_:1})])),_:1})):g("",!0),v(l,{class:"section"},{default:o((()=>[v(l,{class:"section-title-2",onClick:a[2]||(a[2]=e=>ce(n(I)))},{default:o((()=>[v(l,{class:"section-title-2-left"},{default:o((()=>[v(t,{class:"section-title-vertical"}),v(t,{class:"section-title-text"},{default:o((()=>[d("附件")])),_:1})])),_:1}),v(l,{class:_(["section-title-2-right",{active:se(n(I))}])},null,8,["class"])])),_:1}),v(h,{name:"collapse"},{default:o((()=>[se(n(I))?(f(),s(l,{key:0,class:"attachment-section"},{default:o((()=>[v(F,{list:O.value},null,8,["list"])])),_:1})):g("",!0)])),_:1})])),_:1}),v(l,{class:"section"},{default:o((()=>[v(l,{class:"section-title-2",onClick:a[3]||(a[3]=e=>ce(n(N)))},{default:o((()=>[v(l,{class:"section-title-2-left"},{default:o((()=>[v(t,{class:"section-title-vertical"}),v(t,{class:"section-title-text"},{default:o((()=>[d("审批记录")])),_:1})])),_:1}),v(l,{class:_(["section-title-2-right",{active:se(n(N))}])},null,8,["class"])])),_:1}),v(h,{name:"collapse"},{default:o((()=>[se(n(N))?(f(),s(l,{key:0,class:"approval-record-section"},{default:o((()=>[v(L,{list:n(le)},null,8,["list"])])),_:1})):g("",!0)])),_:1})])),_:1})])),_:1}),v(P,{ref_key:"inputDialogRef",ref:W,required:n(X),title:n(z),placeholder:n(Y),onConfirm:n(Z),onCancel:n($)},null,8,["required","title","placeholder","onConfirm","onCancel"])])),_:1})}}},[["__scopeId","data-v-9f466f62"]]);export{M as default};
