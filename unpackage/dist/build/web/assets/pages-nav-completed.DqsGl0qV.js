import{y as e,r as a,$ as l,z as s,A as t,l as o,p as u,c as n,d as c,w as r,m as i,B as d,C as f,i as m,o as p,e as v,n as _,f as g,D as h,E as b,q as y,t as x,F as k,G as j,s as q,h as C,I as w,H as N,x as F,J as R,K as V,L as B,u as P,v as z}from"./index-vclNGZkt.js";import{_ as D}from"./uni-nav-bar.C4KqgVBC.js";import{o as H,a as I,b as A,c as G,r as K}from"./uni-app.es.C4xkBdw-.js";import{_ as L}from"./z-paging.BYUayfj1.js";import{_ as T}from"./search.ByzXnQub.js";import{g as U}from"./storage.D9vc3L4u.js";import{h as W}from"./request.BGjJ8WZd.js";import{f as $,a as E}from"./h5Bribge.BpFLbEvQ.js";import{B as J}from"./bottomNavBar.BXd0ouO1.js";import{F as M}from"./filterPopup.Tc-0erPi.js";import{_ as O}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-icons.Cl6Lj6n6.js";import"./uni-popup.DprRcyc1.js";const Q=O({__name:"completed",setup(O){e((e=>({d8031280:de.value})));const Q=a(0);H((()=>{const e=U("statusBarHeight");0!=Number(e)&&(Q.value=Number(e)),l("refresh-completed",(()=>{ne()}))})),I((()=>{s("refresh-completed")}));const S=a(null),X=a(""),Y=a(0),Z=[{label:"所有",wf:""},{label:"流转中",wf:"Running"},{label:"已审核",wf:"Completed"}],ee=a(Z.map((e=>e.wf))),ae=a(Z.map((e=>e.label))),le=a(null);function se(){var e;null==(e=le.value)||e.open()}function te(e){console.log("筛选结果",e)}function oe(){console.log("重置筛选")}const ue=()=>{j(),ne()},ne=()=>{S.value.reload()},ce=()=>{console.log("下拉刷新触发")},re=a([]),ie=(e,a)=>{W.get("/WF/GetInvolvedProcess",{Page:e,Limit:a,Wfstatus:ee.value[Y.value],RequestFormNo:X.value}).then((e=>{S.value.complete(e.data.data||[])})).catch((()=>{S.value.complete(!1),q({title:"加载失败",icon:"none"})}))};A((()=>{console.log("页面显示，重新计算高度"),t((()=>{fe()}))})),G((()=>{console.log("页面隐藏")}));const de=a(""),fe=()=>{try{const{windowHeight:e}=i(),a=d();f().in(null==a?void 0:a.proxy).select(".header-stickt").boundingClientRect((a=>{const l=(null==a?void 0:a.height)||0,s=Math.max(0,e-l);de.value=`${s}px`})).exec()}catch(e){de.value="calc(100vh - 100rpx)"}};return o((()=>{var e;console.log("订单页面加载完成"),t((()=>fe())),null==(e=u)||e((()=>fe()))})),(e,a)=>{const l=m,s=C,t=w,o=K(n("uni-nav-bar"),D),u=z,i=K(n("z-paging"),L);return p(),c(l,{class:"order-page"},{default:r((()=>[v(l,{class:"header-stickt"},{default:r((()=>[v(l,{class:"status_bar",style:_({height:2*Q.value+"rpx"})},null,8,["style"]),v(o,{class:"nav-bar-top"},{left:r((()=>[v(l,{class:"nav-bar-title"},{default:r((()=>[g(" 已办流程 ")])),_:1})])),right:r((()=>[v(l,{onClick:se,class:"nav-bar-filter"},{default:r((()=>[g(" 筛选 ")])),_:1})])),default:r((()=>[v(l,{class:"nav-input-view"},{default:r((()=>[v(s,{class:"input-seach",src:T,mode:"",onClick:h(ue,["stop"])}),v(t,{"adjust-position":!1,"hold-keyboard":!0,class:"input-view",placeholder:"搜索",type:"text",modelValue:X.value,"onUpdate:modelValue":a[0]||(a[0]=e=>X.value=e),"confirm-type":"search",onConfirm:ue,onKeyup:b(ue,["enter"])},null,8,["modelValue"])])),_:1})])),_:1}),v(l,{class:"segmented-section"},{default:r((()=>[(p(!0),y(k,null,x(ae.value,((e,a)=>(p(),c(l,{class:"segmented-section-item",key:a,onClick:e=>{return l=a,Y.value=l,ne(),void console.log("切换到:",ae.value[l]);var l}},{default:r((()=>[v(u,{class:"section-item-0",style:{height:"0"}}),v(l,{class:N(["section-item-1",{"section-item-1-active":a===Y.value}])},{default:r((()=>[g(F(e),1)])),_:2},1032,["class"]),v(u,{class:N(["section-item-0",{"section-item-0-active":a===Y.value}])},null,8,["class"])])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1}),v(l,{class:"order-list"},{default:r((()=>[v(i,{ref_key:"paging",ref:S,modelValue:re.value,"onUpdate:modelValue":a[1]||(a[1]=e=>re.value=e),onOnRefresh:ce,onQuery:ie,fixed:!1},{default:r((()=>[v(l,{style:{height:"30rpx"}}),(p(!0),y(k,null,x(re.value,(e=>(p(),c(l,{class:"order-card",key:e.id||e.requestFormNo,onClick:a=>(e=>{P({url:"/pages/detail/index",success(a){console.log("res",a),a.eventChannel.emit("open-detail",{type:"completed",order:e})}})})(e)},{default:r((()=>[R(v(l,{class:"approved-view"},null,512),[[V,"Completed"===(null==e?void 0:e.wfStatus)]]),v(l,{class:"order-header"},{default:r((()=>[v(u,{class:"order-id"},{default:r((()=>[g(F(e.requestFormNo),1)])),_:2},1024),v(l,{class:"order-time"},{default:r((()=>[v(u,{class:"time-text"},{default:r((()=>[g(F(B($)(e.submittedDate)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),v(l,{class:"order-content"},{default:r((()=>[v(l,{class:"quote-section"},{default:r((()=>[v(u,{class:"quote-label"},{default:r((()=>[g("申请费用：")])),_:1}),v(u,{class:"quote-price"},{default:r((()=>[g("¥"+F(B(E)(e.planToPayTotal)||"--"),1)])),_:2},1024)])),_:2},1024),v(l,{class:"quote-section"},{default:r((()=>[v(u,{class:"quote-label"},{default:r((()=>[g("申请单位：")])),_:1}),v(u,{class:"description-text"},{default:r((()=>[g(F(e.procDefName)+" | "+F(e.submittedByName),1)])),_:2},1024)])),_:2},1024),v(l,{class:"quote-section"},{default:r((()=>[v(u,{class:"quote-label"},{default:r((()=>[g("关键信息：")])),_:1}),v(u,{class:"description-text"},{default:r((()=>[g(F(e.taskName),1)])),_:2},1024)])),_:2},1024),v(l,{class:"quote-section"},{default:r((()=>[v(u,{class:"quote-label"},{default:r((()=>[g("业务摘要：")])),_:1}),v(u,{class:"description-text"},{default:r((()=>[g(F(e.stepName),1)])),_:2},1024)])),_:2},1024),v(l,{class:"label-view"},{default:r((()=>[(p(!0),y(k,null,x((null==e?void 0:e.labelArr)||[],((e,a)=>(p(),c(l,{class:"label-item",key:a},{default:r((()=>[v(u,{class:"point-icon"}),v(u,{class:"label-text"},{default:r((()=>[g(F(e.label),1)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1},8,["modelValue"])])),_:1}),v(M,{ref_key:"filterRef",ref:le,onConfirm:te,onReset:oe},null,512),v(J,{ref:"bottomNavRef",modelValueFlag:2},null,512)])),_:1})}}},[["__scopeId","data-v-b99003f2"]]);export{Q as default};
