import{u as e,W as a,R as l,r as t,a as s,c as o,w as i,E as c,i as n,o as u,b as r,d,x as f,q as m,t as v,F as p,J as _,K as y,v as h,X as b,H as g,Y as k,Q as N,y as C,S as T}from"./index-DszEigh-.js";import{u as x,a as j,b as R,d as w,c as P,I as D}from"./attachmentList.DtrauFz4.js";import{o as I,r as q}from"./uni-app.es.yxr7YjqI.js";import{c as F,i as E,a as z,g as L,d as O,F as $,h as A,b as M,A as H}from"./uni-popup.C2LCYpza.js";import{h as S}from"./request.CCTae_dV.js";import{u as U}from"./useDetailCommon.B9s0ALLq.js";import{_ as B}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-nav-bar.CQxrnHAm.js";import"./uni-icons.Bqff-X7n.js";import"./uni-easyinput.BqZ0_ocZ.js";const G=B({__name:"zcys",setup(B){let G;e((e=>({"485d059f":c(le)})));let J=null;I((()=>{var e,l,t;G=null==(t=null==(l=null==(e=a())?void 0:e.proxy)?void 0:l.getOpenerEventChannel)?void 0:t.call(l),J=e=>{K.value=e.type,Q.value=e.order,ye(),fe()},G.on("open-detail",J)})),l((()=>{G&&J&&G.off("open-detail",J),J=null}));const K=t(""),Q=t({}),V=t({}),W=t([]),X=t([]),{urlParams:Y,wfstatusText:Z,setOptions:ee,getOptions:ae}=U({itemDetail:Q,currentType:K,itemDatas:V}),{listHeight:le}=x({headerSelector:".header-stickt",iosFit:!0}),{inputDialogRef:te,inputDialogRequired:se,inputDialogTitle:oe,inputDialogPlaceholder:ie,handleInputConfirm:ce,handleInputCancel:ne,onReject:ue,onApprove:re,approvalRecordList:de,getApprovalRecord:fe}=j({itemDetail:Q,currentType:K,successMessage:"已审批",autoGoBack:!0,autoRefresh:!0}),me=t([{label:"合同名称",value:"",key:"contractName"},{label:"合同编号",value:"",key:"contractNo"},{label:"业务类型",value:"",key:"contractTypeName"},{label:"项目名称/资产名称",value:"",key:"contractObjectName"},{label:"对方单位",value:"",key:"contractRelevantParty"},{label:"合同价（含税）",value:"",key:"contractPrice"},{label:"合同支付子项",value:"",key:"contractItemName"},{label:"预算事项",value:"",key:"budgetItemName"},{label:"本月预计支出",value:"",key:"planToPay"},{label:"款项对应开始日期",value:"",key:"relatedPeriodFrom"},{label:"款项对应结束日期",value:"",key:"relatedPeriodTo"},{label:"是否已确认成本",value:"",key:"isCostConfirmed"},{label:"发票是否已收讫",value:"",key:"isInvoiceReceived"}]),ve=t({}),pe=t({}),_e={relatedPeriodFrom:e=>O(e)||"",relatedPeriodTo:e=>O(e)||"",isCostConfirmed:e=>!0===e?"是":!1===e?"否":"",isInvoiceReceived:e=>!0===e?"是":!1===e?"否":""},ye=()=>{S.get(F[K.value],Y.value).then((e=>{var a;let l=e.data||{};if(V.value=l.entity||{},me.value="NoContract"==V.value.contractNo?E[1]:E[0],me.value.forEach((e=>{const a=V.value[e.key];_e[e.key]?e.value=_e[e.key](a):e.value="number"==typeof a?z(a):a||""})),V.value.isCostConfirmed){let e={label:"确认成本申请单",value:"",key:"costConfirmRequestFormNo"};e.value=V.value.costConfirmRequestFormNo||"",me.value.splice(me.value.length-1,0,e)}if((null==(a=null==l?void 0:l.items)?void 0:a.length)>0){let e=L((null==l?void 0:l.items)||[],"itemName"),a=L((null==l?void 0:l.items)||[],"roadName");const t=new Map;l.items.forEach((e=>{const a=`${e.itemName}|${e.roadName}`;t.set(a,e.costVat)}));let s=[];for(let[l,o]of e){let e=[];for(let[s,o]of a){const a=`${l}|${s}`;e.push({title:s,value:t.get(a)||null})}s.push({title:l,children:e})}ve.value=s,pe.value=a}W.value=[],V.value.contractTypeName&&W.value.push(V.value.contractTypeName);let t=((null==l?void 0:l.attachmentList)||[]).map((e=>({fileTagName:e.fileTagName,fileName:e.fileName,fileUrl:e.fileUrl,id:e.attachmentId})));X.value=[{fileTagName:"工程付款申请单",children:[]},{fileTagName:"工程费用支付申请表",children:[]},{fileTagName:"合同款支付情况统计表",children:[]},{fileTagName:"发票",children:[]},{fileTagName:"财务监理付款意见书",children:[]},{fileTagName:"其他合同约定需提供资料",children:[]}];const s=new Map;X.value.forEach((e=>{s.set(e.fileTagName,e)})),t.forEach((e=>{const a=s.get(e.fileTagName);a&&a.children.push(e)}))}))};return(e,a)=>{const l=n,t=C,x=T,j=q(s("attachmentList"),R);return u(),o(l,{class:"detail-page"},{default:i((()=>[r(l,{class:"header-stickt"},{default:i((()=>[r(w),r(l,{class:"hero-card"},{default:i((()=>[r(l,{class:"hero-header"},{default:i((()=>[r(l,{class:"project-name"},{default:i((()=>[r(l,{class:"project-name-1"},{default:i((()=>[d(f(Q.value.taskName),1)])),_:1}),r(l,{class:"project-name-1"},{default:i((()=>[d(f(V.value.contractName),1)])),_:1})])),_:1}),r(l,{class:"amount-box"},{default:i((()=>[r(l,{class:"amount-label"},{default:i((()=>[d("申请金额")])),_:1}),r(l,{class:"amount-value"},{default:i((()=>[r(t,{class:"amount-value-symbol"},{default:i((()=>[d("¥")])),_:1}),r(t,{class:"amount-value-number"},{default:i((()=>[d(f(c(z)(V.value.planToPay)),1)])),_:1})])),_:1})])),_:1})])),_:1}),r(l,{class:"hero-tags"},{default:i((()=>[(u(!0),m(p,null,v(W.value,((e,a)=>(u(),o(l,{class:"tag",key:a},{default:i((()=>[d(f(e),1)])),_:2},1024)))),128))])),_:1}),_(r(l,{class:"hero-actions"},{default:i((()=>[r(l,{class:"btn outline",onClick:c(ue)},{default:i((()=>[d("打回")])),_:1},8,["onClick"]),r(l,{class:"btn primary",onClick:c(re)},{default:i((()=>[d("通过")])),_:1},8,["onClick"])])),_:1},512),[[y,"pending"===K.value]]),_(r(l,{class:"wfstatus-actions"},{default:i((()=>[d(f(c(Z)),1)])),_:1},512),[[y,"completed"===K.value&&("Running"==V.value.wfstatus||"Completed"==V.value.wfstatus)]])])),_:1})])),_:1}),r(x,{"scroll-y":"true",class:"scroller"},{default:i((()=>[r(l,{class:"section"},{default:i((()=>[r(l,{class:"section-title"},{default:i((()=>[r(t,{class:"section-title-vertical"}),r(t,{class:"section-title-text"},{default:i((()=>[d("基本信息")])),_:1})])),_:1}),r(l,{class:"info-list"},{default:i((()=>[(u(!0),m(p,null,v(me.value,((e,a)=>(u(),o(l,{class:"info-item",key:a},{default:i((()=>[r(t,{class:"info-label"},{default:i((()=>[d(f(e.label),1)])),_:2},1024),r(t,{class:"info-value"},{default:i((()=>[d(f(e.value||"--"),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1}),r(l,{class:"section"},{default:i((()=>[r(l,{class:"section-title-2",onClick:a[0]||(a[0]=e=>c(ee)(c($)))},{default:i((()=>[r(l,{class:"section-title-2-left"},{default:i((()=>[r(t,{class:"section-title-vertical"}),r(t,{class:"section-title-text"},{default:i((()=>[d("费用组成")])),_:1})])),_:1}),r(l,{class:h(["section-title-2-right",{active:c(ae)(c($))}])},null,8,["class"])])),_:1}),r(b,{name:"collapse"},{default:i((()=>[c(ae)(c($))?(u(),o(l,{key:0,class:"usage-details"},{default:i((()=>[r(x,{"scroll-x":"",class:"table-scroll-x",onTouchmove:g(c(A),["stop"])},{default:i((()=>[k("table",{cellspacing:"0",cellpadding:"0",class:"table1 table2"},[k("tbody",null,[k("tr",null,[k("td",{class:"type font_w sticky-xz-1 bordr-none"},"费用类目"),(u(!0),m(p,null,v(pe.value,(([e,a])=>(u(),m("td",{class:h(["type font_w text_right bordr-none bordr-right-none",{"sticky-xz-2":null==e}]),key:e},f(null==e?"合计":e||""),3)))),128))]),(u(!0),m(p,null,v(ve.value,((e,a)=>(u(),m("tr",{key:a},[k("td",{class:h(["text sticky-xz-1",{"bordr-none":0==a}])},f(e.title||""),3),(u(!0),m(p,null,v(e.children,((e,l)=>(u(),m("td",{class:h(["info",{"sticky-xz-2":0==l,"bordr-none":0==a}]),key:l},f(c(z)(e.value)),3)))),128))])))),128))])])])),_:1},8,["onTouchmove"]),r(l,{class:"detail-row summary-row"},{default:i((()=>[r(t,{class:"detail-label summary-label"},{default:i((()=>[d("本次小计")])),_:1}),r(t,{class:"detail-value summary-value"},{default:i((()=>[d(f(c(z)(V.value.planToPay)),1)])),_:1})])),_:1})])),_:1})):N("",!0)])),_:1})])),_:1}),r(l,{class:"section"},{default:i((()=>[r(l,{class:"section-title-2",onClick:a[1]||(a[1]=e=>c(ee)(c(M)))},{default:i((()=>[r(l,{class:"section-title-2-left"},{default:i((()=>[r(t,{class:"section-title-vertical"}),r(t,{class:"section-title-text"},{default:i((()=>[d("附件")])),_:1})])),_:1}),r(l,{class:h(["section-title-2-right",{active:c(ae)(c(M))}])},null,8,["class"])])),_:1}),r(b,{name:"collapse"},{default:i((()=>[c(ae)(c(M))?(u(),o(l,{key:0,class:"attachment-section"},{default:i((()=>[r(j,{list:X.value},null,8,["list"])])),_:1})):N("",!0)])),_:1})])),_:1}),r(l,{class:"section"},{default:i((()=>[r(l,{class:"section-title-2",onClick:a[2]||(a[2]=e=>c(ee)(c(H)))},{default:i((()=>[r(l,{class:"section-title-2-left"},{default:i((()=>[r(t,{class:"section-title-vertical"}),r(t,{class:"section-title-text"},{default:i((()=>[d("审批记录")])),_:1})])),_:1}),r(l,{class:h(["section-title-2-right",{active:c(ae)(c(H))}])},null,8,["class"])])),_:1}),r(b,{name:"collapse"},{default:i((()=>[c(ae)(c(H))?(u(),o(l,{key:0,class:"approval-record-section"},{default:i((()=>[r(P,{list:c(de)},null,8,["list"])])),_:1})):N("",!0)])),_:1})])),_:1})])),_:1}),r(D,{ref_key:"inputDialogRef",ref:te,required:c(se),title:c(oe),placeholder:c(ie),onConfirm:c(ce),onCancel:c(ne)},null,8,["required","title","placeholder","onConfirm","onCancel"])])),_:1})}}},[["__scopeId","data-v-76c6c687"]]);export{G as default};
