import{r as e,p as a,z as l,A as t,B as s,R as o,T as n,W as i,L as r,s as p,Z as u,a as c,o as d,q as v,b as m,n as f,w as g,P as _,d as y,x as h,F as k,i as w,l as b,D as x,c as R,v as T,E as A,y as C,t as j,Q as I,H as D,j as z}from"./index-DszEigh-.js";import{h as N}from"./request.CCTae_dV.js";import{j as L,_ as E,t as F,k as H}from"./uni-popup.C2LCYpza.js";import{_ as B}from"./uni-nav-bar.CQxrnHAm.js";import{r as S}from"./uni-app.es.yxr7YjqI.js";import{_ as P}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{_ as V}from"./uni-easyinput.BqZ0_ocZ.js";import{_ as q}from"./uni-icons.Bqff-X7n.js";function U(p={}){const{headerSelector:u=".header-stickt",fallbackHeight:c="calc(100vh - 50px)",autoCompute:d=!0,enableResize:v=!0,iosFit:m=!1}=p;console.log("来了这里了吗0000",u);const f=e(""),g=()=>{try{const{windowHeight:e}=s(),a=i();r().in(null==a?void 0:a.proxy).select(u).boundingClientRect((a=>{const l=(null==a?void 0:a.height)||0,t=Math.max(0,e-l);f.value=`${t}px`})).exec()}catch(e){console.warn("计算列表高度失败:",e),f.value=c}};let _=null,y=null,h=null,k=null,w=null;return d&&(a((()=>{var e,a;if(console.log("页面加载完成，计算列表高度"),l((()=>g())),w=setTimeout((()=>{g()}),500),v&&(_=()=>g(),null==(e=t)||e(_)),m){const e=s(),l="ios"===e.platform,t="h5"===e.platform||!0;l&&t?(y=()=>{setTimeout((()=>{window.scrollTo({top:0,left:0,behavior:"instant"})}),20)},document.addEventListener("focusout",y)):(h=()=>g(),k=()=>g(),null==(a=window.visualViewport)||a.addEventListener("resize",h),window.addEventListener("resize",k))}})),o((()=>{var e;_&&"function"==typeof n&&(n(_),_=null),y&&(document.removeEventListener("focusout",y),y=null),h&&(null==(e=window.visualViewport)||e.removeEventListener("resize",h),h=null),k&&(window.removeEventListener("resize",k),k=null),_=null,clearTimeout(w),w=null}))),{listHeight:f,computeScrollHeight:g}}function W(a={}){const{itemDetail:l,currentType:t,onSuccess:s,onError:n,successMessage:i="已审批",autoGoBack:r=!0,autoRefresh:c=!0}=a;console.log("来了这里了吗22222",l.value);const d=e(null),v=e(!1),m=e(""),f=e(""),g=e(""),_=e([]);let y=null;const h=(e,a,l=!1)=>{var t;m.value=e,f.value=a,v.value=l,g.value="",null==(t=d.value)||t.open()},k=(e,a={})=>{if(!(null==l?void 0:l.value))return void p({title:"缺少审批信息",icon:"none"});const o={wfInstanceId:l.value.wfinstanceId,workItemId:l.value.workItemId,approvalComment:g.value,annotationComment:"",pictureBaseData:"",isApproval:e,procDefCode:l.value.procDefCode,...a};N.post("/WF/SubmitApproval",o).then((e=>{0===e.code?(p({title:i,icon:"success"}),s&&s(e),y=setTimeout((()=>{c&&"pending"===(null==t?void 0:t.value)&&(u("refresh-pending"),u("refresh-completed")),r&&L()}),1e3)):(p({title:e.message||"审批失败",icon:"none"}),n&&n(e))})).catch((e=>{console.error("审批提交失败:",e),p({title:"网络错误，请重试",icon:"none"}),n&&n(e)}))};return o((()=>{y&&(clearTimeout(y),y=null)})),{inputDialogRef:d,inputDialogRequired:v,inputDialogTitle:m,inputDialogPlaceholder:f,inputDialogValue:g,approvalRecordList:_,openInputDialog:h,handleInputConfirm:(e,a)=>{var l;g.value=e,null==(l=d.value)||l.close(),k(a)},handleInputCancel:()=>{var e;null==(e=d.value)||e.close(),g.value=""},doSubmitApproval:k,onReject:()=>{h("打回原因","请输入打回原因",!0)},onApprove:()=>{h("通过原因","请输入通过原因",!1)},getApprovalRecord:()=>{N.get("/WF/GetApprovalHistory",{wfinstanceId:l.value.wfinstanceId}).then((e=>{_.value=e.data||[]}))}}}const $=P({__name:"detailNavBar",props:{title:{type:String,default:"审批详情"},statusBarHeight:{type:Number,default:0}},emits:["back"],setup(e,{emit:a}){const l=a,t=()=>{l("back"),L()};return(a,l)=>{const s=w,o=S(c("uni-nav-bar"),B);return d(),v(k,null,[m(s,{class:"status_bar",style:f({height:2*e.statusBarHeight+"rpx"})},null,8,["style"]),m(o,{class:"nav-bar-top"},{left:g((()=>[m(s,{class:"back-btn",onClick:t})])),right:g((()=>[_(a.$slots,"right",{},(()=>[m(s,{style:{width:"40rpx"}})]),!0)])),default:g((()=>[m(s,{class:"nav-title"},{default:g((()=>[y(h(e.title),1)])),_:1})])),_:3})],64)}}},[["__scopeId","data-v-1f9f3999"]]),G=P({__name:"inputDialog",props:{modelValue:{type:Boolean,default:void 0},title:{type:String,default:void 0},placeholder:{type:String,default:void 0},maxlength:{type:Number,default:void 0},required:{type:Boolean,default:void 0},validator:{type:Function,default:void 0}},emits:["confirm","cancel"],setup(a,{expose:l,emit:t}){const s=F((()=>{!function(){if(_.value)return;let e=f[o.title];n("confirm",r.value,e),r.value="",k()}()}),1e3),o=a,n=t,i=e(null),r=e(""),p=b((()=>o.title??"输入内容")),u=b((()=>o.placeholder??"请输入内容"));b((()=>o.inputType??"text"));const v=b((()=>o.maxlength??140)),f=x({"打回原因":!1,"通过原因":!0}),_=b((()=>{if(o.required&&!r.value)return!0;return!0!==(!o.validator||o.validator(r.value))}));function k(){var e,a;null==(a=null==(e=i.value)?void 0:e.close)||a.call(e)}function j(){n("cancel"),r.value="",k()}return l({open:function(){var e,a;null==(a=null==(e=i.value)?void 0:e.open)||a.call(e,"center")},close:k}),(e,a)=>{const l=C,t=S(c("uni-easyinput"),V),o=w,n=S(c("uni-popup"),E);return d(),R(n,{ref_key:"popupRef",ref:i,type:"center","mask-click":!1},{default:g((()=>[m(o,{class:"idlg"},{default:g((()=>[m(l,{class:"idlg-title"},{default:g((()=>[y(h(p.value),1)])),_:1}),m(o,{class:"idlg-input-wrap"},{default:g((()=>[m(t,{type:"textarea",placeholder:u.value,clearable:!0,maxlength:v.value,autoHeight:"",modelValue:r.value,"onUpdate:modelValue":a[0]||(a[0]=e=>r.value=e)},null,8,["placeholder","maxlength","modelValue"])])),_:1}),m(o,{class:"idlg-footer"},{default:g((()=>[m(o,{class:"btn cancel",onClick:j},{default:g((()=>[y("取消")])),_:1}),m(o,{class:"divider"}),m(o,{class:T(["btn confirm",{disabled:_.value}]),onClick:A(s)},{default:g((()=>[y("确定")])),_:1},8,["class","onClick"])])),_:1})])),_:1})])),_:1},512)}}},[["__scopeId","data-v-b34d2011"]]),M=P({__name:"approvalTimeline",props:{list:{type:Array,default:()=>[]}},setup:e=>(a,l)=>{const t=S(c("uni-icons"),q),s=w,o=C;return d(),R(s,{class:"approval-timeline"},{default:g((()=>[(d(!0),v(k,null,j(e.list,((e,a)=>(d(),R(s,{class:"approval-item",key:a},{default:g((()=>[m(s,{class:"timeline-indicator-container"},{default:g((()=>[m(s,{class:T(["timeline-indicator",{"status-pending":"vmPending"===e.approvalActionType,"status-approved":"已审批"===e.approvalActionType&&"批准"==e.approvalResult,"status-rejected":"已审批"===e.approvalActionType&&("驳回"==e.approvalResult||"已拒绝"==e.approvalResult),"status-successed":"完成"==e.approvalResult||"处理完成"===e.approvalResult,"status-submitted":"提交"===e.approvalActionType}])},{default:g((()=>["完成"==e.approvalResult||"处理完成"===e.approvalResult?(d(),R(s,{key:0,class:"indicator-checkmark"},{default:g((()=>[m(t,{type:"smallcircle-filled",size:"24rpx",color:"#07c160"})])),_:1})):I("",!0),"已审批"===e.approvalActionType&&"批准"==e.approvalResult?(d(),R(s,{key:1,class:"indicator-checkmark"},{default:g((()=>[m(t,{type:"checkmarkempty",size:"20rpx",color:"#07c160"})])),_:1})):I("",!0),"已审批"!==e.approvalActionType||"驳回"!=e.approvalResult&&"已拒绝"!=e.approvalResult?"vmPending"===e.approvalActionType?(d(),R(s,{key:3,class:"indicator-loading"})):"提交"===e.approvalActionType?(d(),R(s,{key:4,class:"indicator-empty"})):I("",!0):(d(),R(s,{key:2,class:"indicator-checkmark"},{default:g((()=>[m(t,{type:"checkmarkempty",size:"20rpx",color:"#ffb800"})])),_:1}))])),_:2},1032,["class"])])),_:2},1024),m(s,{class:"approval-content"},{default:g((()=>[m(s,{class:"approval-header"},{default:g((()=>[m(s,{class:"approval-title"},{default:g((()=>[m(o,{class:"title-text"},{default:g((()=>[y(h(e.stepName),1)])),_:2},1024),m(o,{class:T(["title-status",{"status-text-green":"已审批"===e.approvalActionType||"vmPending"===e.approvalActionType||"提交"===e.approvalActionType}])},{default:g((()=>[y(h("vmPending"==e.approvalActionType?"审批中":e.approvalActionType),1)])),_:2},1032,["class"])])),_:2},1024)])),_:2},1024),m(s,{class:"approval-body"},{default:g((()=>[m(s,{class:"approval-info",style:{display:"flex","justify-content":"flex-start",gap:"10rpx"}},{default:g((()=>[m(o,{class:"approver-name"},{default:g((()=>[y(h(e.approverDisplayName),1)])),_:2},1024),m(s,{class:T(["action-btn",{"btn-approved":"批准"==e.approvalResult||"提交"==e.approvalResult||"完成"==e.approvalResult||"处理完成"===e.approvalResult,"btn-pending":"待审批"==e.approvalResult||"待处理"==e.approvalResult,"btn-rejected":"驳回"==e.approvalResult||"已拒绝"==e.approvalResult}])},{default:g((()=>[y(h(e.approvalResult),1)])),_:2},1032,["class"]),m(o,{class:"approval-time"},{default:g((()=>[y(h(A(H)("待审批"==e.approvalResult?e.approvalTime:e.createdDate)),1)])),_:2},1024)])),_:2},1024),e.approvalComment?(d(),R(s,{key:0,class:"approval-remark"},{default:g((()=>[m(o,{class:"remark-label"},{default:g((()=>[y("备注:")])),_:1}),m(o,{class:"remark-text"},{default:g((()=>[y(h(e.approvalComment),1)])),_:2},1024)])),_:2},1024)):I("",!0)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})}},[["__scopeId","data-v-0c9842fd"]]),Z=P({__name:"attachmentList",props:{list:{type:Array,default:()=>[]}},setup(a){const t=a,s=b((()=>t.list)),o=e(null),n=e(null),i=b((()=>{const e=n.value;return!!e&&["jpg","jpeg","png","gif","bmp","webp"].includes(_(e))})),r=e=>{const a=_(e);return["jpg","jpeg","png","gif","bmp","webp"].includes(a)?"../../static/images/pic.png":"pdf"===a?"../../static/images/pdf.png":["xls","xlsx","csv"].includes(a)?"../../static/images/excel.png":["doc","docx"].includes(a)?"../../static/images/docx.png":"../../static/images/file.png"},u=()=>{var e;null==(e=o.value)||e.close()},f=()=>{var e;const a=null==(e=n.value)?void 0:e.fileUrl;a?window.open(a,"_blank"):p({title:"暂无附件地址",icon:"none"})},_=e=>{const a=(null==e?void 0:e.fileName)||(null==e?void 0:e.fileUrl)||"",l=/\.([a-zA-Z0-9]+)(?:\?|#|$)/.exec(a);return l?l[1].toLowerCase():""};return(e,a)=>{const t=w,p=C,_=z,b=S(c("uni-icons"),q),x=S(c("uni-popup"),E);return d(),R(t,{class:"attachment-wrapper"},{default:g((()=>[(d(!0),v(k,null,j(s.value,(e=>(d(),R(t,{class:"attachment-list",key:e.fileTagName},{default:g((()=>[m(t,{class:"attachment-header"},{default:g((()=>[m(t,{class:T(["attachment-header-bar",{"attachment-header-bar-2":e.children.length>0}])},null,8,["class"]),m(p,{class:"attachment-header-text"},{default:g((()=>[y(h(e.fileTagName),1)])),_:2},1024)])),_:2},1024),m(t,{class:"attachment-item-list"},{default:g((()=>[(d(!0),v(k,null,j(e.children,(e=>(d(),R(t,{class:"attachment-item",key:e.id,onClick:a=>(e=>{n.value=e,l((()=>{var e;null==(e=o.value)||e.open()}))})(e)},{default:g((()=>[m(t,{class:"attachment-item-icon"},{default:g((()=>[m(_,{src:r(e),mode:"aspectFit",class:"attachment-icon-image"},null,8,["src"])])),_:2},1024),m(t,{class:"attachment-item-text"},{default:g((()=>[y(h(e.fileName),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:2},1024)])),_:2},1024)))),128)),m(x,{ref_key:"previewPopupRef",ref:o,type:"bottom","mask-click":!0},{default:g((()=>[m(t,{class:"preview-popup",onTouchmove:a[0]||(a[0]=D((()=>{}),["stop","prevent"]))},{default:g((()=>[m(t,{class:"preview-header"},{default:g((()=>[m(p,{class:"preview-title"},{default:g((()=>{var e;return[y(h((null==(e=n.value)?void 0:e.fileTagName)||"附件预览"),1)]})),_:1}),m(b,{type:"closeempty",size:"30",color:"#666",onClick:u})])),_:1}),n.value?(d(),R(t,{key:0,class:"preview-body"},{default:g((()=>[i.value?(d(),R(_,{key:0,class:"preview-image",src:n.value.fileUrl||n.value.url,mode:"aspectFit","show-menu-by-longpress":""},null,8,["src"])):(d(),R(t,{key:1,class:"preview-file"},{default:g((()=>[m(_,{src:r(n.value),mode:"aspectFit",class:"preview-file-icon"},null,8,["src"]),m(p,{class:"preview-file-name"},{default:g((()=>[y(h(n.value.fileName||n.value.fileUrl||"无文件名称"),1)])),_:1}),m(t,{class:"preview-actions"},{default:g((()=>[m(t,{class:"preview-action-btn",onClick:f},{default:g((()=>[m(b,{type:"download",size:"28",color:"#3C6CFE"}),m(p,{class:"preview-action-text"},{default:g((()=>[y("打开附件")])),_:1})])),_:1})])),_:1})])),_:1}))])),_:1})):I("",!0)])),_:1})])),_:1},512)])),_:1})}}},[["__scopeId","data-v-4cc7f51f"]]);export{G as I,W as a,Z as b,M as c,$ as d,U as u};
