import{u as a,W as e,R as l,r as t,D as s,l as c,a as n,c as u,w as o,E as i,i as f,o as d,b as r,d as m,x as v,q as p,t as _,F as y,J as k,K as g,v as b,X as h,H as x,Y as N,Q as w,y as C,S as A}from"./index-DszEigh-.js";import{u as I,a as T,b as j,d as z,c as q,I as R}from"./attachmentList.DtrauFz4.js";import{o as D,r as L}from"./uni-app.es.yxr7YjqI.js";import{F as E,P as B,A as V,b as F,c as P,a as Q,e as H,h as M}from"./uni-popup.C2LCYpza.js";import{h as O}from"./request.CCTae_dV.js";import{_ as S}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-nav-bar.CQxrnHAm.js";import"./uni-icons.Bqff-X7n.js";import"./uni-easyinput.BqZ0_ocZ.js";const U=S({__name:"qtjf",setup(S){let U;a((a=>({"770ddf44":i($)})));let G=null;D((()=>{var a,l,t;U=null==(t=null==(l=null==(a=e())?void 0:a.proxy)?void 0:l.getOpenerEventChannel)?void 0:t.call(l),G=a=>{J.value=a.type,W.value=a.order,ka(),ia()},U.on("open-detail",G)})),l((()=>{U&&G&&U.off("open-detail",G),G=null}));const J=t(""),K=s({QT01:["claimItemAmountNet","claimItemTaxAmount","claimItemAmountVat"]}),W=t({}),X=t([]),Y=c((()=>"Running"==pa.value.wfstatus?"流转中":"Completed"==pa.value.wfstatus?"已审批":"")),Z=t([]),{listHeight:$}=I({headerSelector:".header-stickt",iosFit:!0}),{inputDialogRef:aa,inputDialogRequired:ea,inputDialogTitle:la,inputDialogPlaceholder:ta,handleInputConfirm:sa,handleInputCancel:ca,onReject:na,onApprove:ua,approvalRecordList:oa,getApprovalRecord:ia}=T({itemDetail:W,currentType:J,successMessage:"已审批",autoGoBack:!0,autoRefresh:!0}),fa=s({[E]:!0,[B]:!0,[V]:!0,[F]:!0}),da=a=>{fa[a]=!fa[a]},ra=a=>fa[a],ma=c((()=>({pending:{procCode:W.value.procDefCode,workitemid:W.value.workItemId},completed:{procCode:W.value.procDefCode,wfInstanceId:W.value.wfinstanceId}}[J.value]))),va=t([{label:"用款部门",value:"",key:"companyName"},{label:"付款单位",value:"",key:"paymentCompanyName"},{label:"付款名称",value:"",key:"receivingBankName"},{label:"支付金额",value:"",key:"paymentAmount"},{label:"收款单位",value:"",key:"receivingCompanyName"},{label:"收款开户银行",value:"",key:"receivingBankAccountName"},{label:"收款账号",value:"",key:"receivingBankAccountNumber"}]),pa=t({}),_a=t([]),ya=s({}),ka=()=>{O.get(P[J.value],ma.value).then((a=>{var e;let l=(null==(e=a.data)?void 0:e.data)||{};pa.value=(null==l?void 0:l.wfrequestregularpayment)||{},va.value.forEach((a=>{a.value="number"==typeof pa.value[a.key]||"paymentAmount"===a.key?Q(pa.value[a.key]):pa.value[a.key]||""}));let t=K.QT01||[];(null==l?void 0:l.wfrequestregularpaymentitems)&&(_a.value=(null==l?void 0:l.wfrequestregularpaymentitems)||[],t.forEach((a=>{ya[a]=H(_a.value,a)}))),pa.value.companyName&&X.value.push(pa.value.companyName);let s=((null==l?void 0:l.attachementList)||[]).map((a=>({fileTagName:a.fileTagName,fileName:a.fileName,fileUrl:a.fileUrl,id:a.attachmentId})));Z.value=[{fileTagName:"合同",children:[]},{fileTagName:"发票/收据",children:[]},{fileTagName:"其他",children:[]}];const c=new Map;Z.value.forEach((a=>{c.set(a.fileTagName,a)})),s.forEach((a=>{const e=c.get(a.fileTagName);e&&e.children.push(a)}))}))};return(a,e)=>{const l=f,t=C,s=A,c=L(n("attachmentList"),j);return d(),u(l,{class:"detail-page"},{default:o((()=>[r(l,{class:"header-stickt"},{default:o((()=>[r(z),r(l,{class:"hero-card"},{default:o((()=>[r(l,{class:"hero-header"},{default:o((()=>[r(l,{class:"project-name"},{default:o((()=>[r(l,{class:"project-name-1"},{default:o((()=>[m(v(W.value.taskName),1)])),_:1}),r(l,{class:"project-name-1"},{default:o((()=>[m(" 上海城投公路投资（集团）有限公司 ")])),_:1})])),_:1}),r(l,{class:"amount-box"},{default:o((()=>[r(l,{class:"amount-label"},{default:o((()=>[m("申请支付总金额")])),_:1}),r(l,{class:"amount-value"},{default:o((()=>[r(t,{class:"amount-value-symbol"},{default:o((()=>[m("¥")])),_:1}),r(t,{class:"amount-value-number"},{default:o((()=>[m(v(i(Q)(pa.value.paymentAmount)),1)])),_:1})])),_:1})])),_:1})])),_:1}),r(l,{class:"hero-tags"},{default:o((()=>[(d(!0),p(y,null,_(X.value,((a,e)=>(d(),u(l,{class:"tag",key:e},{default:o((()=>[m(v(a),1)])),_:2},1024)))),128))])),_:1}),k(r(l,{class:"hero-actions"},{default:o((()=>[r(l,{class:"btn outline",onClick:i(na)},{default:o((()=>[m("打回")])),_:1},8,["onClick"]),r(l,{class:"btn primary",onClick:i(ua)},{default:o((()=>[m("通过")])),_:1},8,["onClick"])])),_:1},512),[[g,"pending"===J.value]]),k(r(l,{class:"wfstatus-actions"},{default:o((()=>[m(v(Y.value),1)])),_:1},512),[[g,"completed"===J.value&&("Running"==pa.value.wfstatus||"Completed"==pa.value.wfstatus)]])])),_:1})])),_:1}),r(s,{"scroll-y":"true",class:"scroller"},{default:o((()=>[r(l,{class:"section"},{default:o((()=>[r(l,{class:"section-title"},{default:o((()=>[r(t,{class:"section-title-vertical"}),r(t,{class:"section-title-text"},{default:o((()=>[m("基本信息")])),_:1})])),_:1}),r(l,{class:"info-list"},{default:o((()=>[(d(!0),p(y,null,_(va.value,((a,e)=>(d(),u(l,{class:b(["info-item",{"info-item-border":"paymentAmount"===a.key||"receivingBankAccountNumber"===a.key||"companyName"===a.key}]),key:e},{default:o((()=>[r(t,{class:"info-label"},{default:o((()=>[m(v(a.label),1)])),_:2},1024),r(t,{class:"info-value"},{default:o((()=>[m(v(a.value||"--"),1)])),_:2},1024)])),_:2},1032,["class"])))),128)),r(l,{class:"info-item"},{default:o((()=>[r(t,{class:"info-label"},{default:o((()=>[m("支付内容备注")])),_:1}),r(t,{class:"info-value"},{default:o((()=>[m(v(pa.value.content||"--"),1)])),_:1})])),_:1})])),_:1})])),_:1}),_a.value.length>0?(d(),u(l,{key:0,class:"section"},{default:o((()=>[r(l,{class:"section-title-2",onClick:e[0]||(e[0]=a=>da(i(E)))},{default:o((()=>[r(l,{class:"section-title-2-left"},{default:o((()=>[r(t,{class:"section-title-vertical"}),r(t,{class:"section-title-text"},{default:o((()=>[m("支付内容")])),_:1})])),_:1}),r(l,{class:b(["section-title-2-right",{active:ra(i(E))}])},null,8,["class"])])),_:1}),r(h,{name:"collapse"},{default:o((()=>[ra(i(E))?(d(),u(l,{key:0,class:"usage-details"},{default:o((()=>[_a.value.length>0?(d(),u(s,{key:0,"scroll-x":"",class:"table-scroll-x",onTouchmove:x(i(M),["stop"])},{default:o((()=>[N("table",{cellspacing:"0",cellpadding:"0",class:"table1 table2"},[N("tbody",null,[N("tr",null,[N("td",{class:"type font_w sticky-xz-1 bordr-none"},"明细"),N("td",{class:"type font_w text_right sticky-xz-2 bordr-none bordr-right-none"},"合计"),(d(!0),p(y,null,_(_a.value,((a,e)=>(d(),p("td",{class:"type font_w text_right bordr-none",key:e})))),128))]),N("tr",null,[N("td",{class:"text sticky-xz-1 bordr-none"},"报销类目"),N("td",{class:"info sticky-xz-2 bordr-none"}),(d(!0),p(y,null,_(_a.value,((a,e)=>(d(),p("td",{class:"info info-plus bordr-none",key:e},v((a=>[a.claimCategoryNameLv1,a.claimCategoryNameLv2,a.claimCategoryNameLv3,a.claimCategoryName].filter(((a,e,l)=>a&&l.indexOf(a)===e)).join("/")||"")(a)),1)))),128))]),N("tr",null,[N("td",{class:"text sticky-xz-1"},"报销内容"),N("td",{class:"info sticky-xz-2"}),(d(!0),p(y,null,_(_a.value,((a,e)=>(d(),p("td",{class:"info info-plus",key:e},v(a.claimName||""),1)))),128))]),N("tr",null,[N("td",{class:"text sticky-xz-1"},"不含税金额"),N("td",{class:"info sticky-xz-2"},v(i(Q)(ya.claimItemAmountNet)),1),(d(!0),p(y,null,_(_a.value,((a,e)=>(d(),p("td",{class:"info info-plus",key:e},v(i(Q)(a.claimItemAmountNet)),1)))),128))]),N("tr",null,[N("td",{class:"text sticky-xz-1"},"可抵扣税额"),N("td",{class:"info sticky-xz-2"},v(i(Q)(ya.claimItemTaxAmount)),1),(d(!0),p(y,null,_(_a.value,((a,e)=>(d(),p("td",{class:"info info-plus",key:e},v(i(Q)(a.claimItemTaxAmount)),1)))),128))]),N("tr",null,[N("td",{class:"text sticky-xz-1"},"含税金额"),N("td",{class:"info sticky-xz-2"},v(i(Q)(ya.claimItemAmountVat)),1),(d(!0),p(y,null,_(_a.value,((a,e)=>(d(),p("td",{class:"info info-plus",key:e},v(i(Q)(a.claimItemAmountVat)),1)))),128))]),N("tr",null,[N("td",{class:"text sticky-xz-1"},"备注"),N("td",{class:"info sticky-xz-2"}),(d(!0),p(y,null,_(_a.value,((a,e)=>(d(),p("td",{class:"info info-plus",key:e},v(a.remark||""),1)))),128))])])])])),_:1},8,["onTouchmove"])):w("",!0),_a.value.length>0?(d(),u(l,{key:1,class:"detail-row summary-row"},{default:o((()=>[r(t,{class:"detail-label summary-label"},{default:o((()=>[m("本次小计")])),_:1}),r(t,{class:"detail-value summary-value"},{default:o((()=>[m(v(i(Q)(pa.value.paymentAmount)),1)])),_:1})])),_:1})):w("",!0)])),_:1})):w("",!0)])),_:1})])),_:1})):w("",!0),r(l,{class:"section"},{default:o((()=>[r(l,{class:"section-title-2",onClick:e[1]||(e[1]=a=>da(i(B)))},{default:o((()=>[r(l,{class:"section-title-2-left"},{default:o((()=>[r(t,{class:"section-title-vertical"}),r(t,{class:"section-title-text"},{default:o((()=>[m("补充信息")])),_:1})])),_:1}),r(l,{class:b(["section-title-2-right",{active:ra(i(B))}])},null,8,["class"])])),_:1}),r(h,{name:"collapse"},{default:o((()=>[ra(i(B))?(d(),u(l,{key:0,class:"account-info-section"},{default:o((()=>[r(l,{class:"account-card"},{default:o((()=>[r(l,{class:"account-info-block"},{default:o((()=>[r(l,{class:"account-info-row"},{default:o((()=>[r(t,{class:"account-info-label"},{default:o((()=>[m("发票系统编号")])),_:1}),r(t,{class:"account-info-value"},{default:o((()=>[m(v(pa.value.invoiceCloudId||""),1)])),_:1})])),_:1}),r(l,{class:"account-info-row"},{default:o((()=>[r(t,{class:"account-info-label"},{default:o((()=>[m("合同名称")])),_:1}),r(t,{class:"account-info-value"},{default:o((()=>[m(v(pa.value.contractName||""),1)])),_:1})])),_:1}),r(l,{class:"account-info-row"},{default:o((()=>[r(t,{class:"account-info-label"},{default:o((()=>[m("普票金额")])),_:1}),r(t,{class:"account-info-value"},{default:o((()=>[m(v(i(Q)(pa.value.vatoamount)||""),1)])),_:1})])),_:1}),r(l,{class:"account-info-row"},{default:o((()=>[r(t,{class:"account-info-label"},{default:o((()=>[m("进项税额")])),_:1}),r(t,{class:"account-info-value"},{default:o((()=>[m(v(i(Q)(pa.value.invoiceAmountVat)||""),1)])),_:1})])),_:1}),r(l,{class:"account-info-row"},{default:o((()=>[r(t,{class:"account-info-label"},{default:o((()=>[m("合同价/审定价")])),_:1}),r(t,{class:"account-info-value"},{default:o((()=>[m(v(i(Q)(pa.value.contractAmountVat)||""),1)])),_:1})])),_:1}),r(l,{class:"account-info-row"},{default:o((()=>[r(t,{class:"account-info-label"},{default:o((()=>[m("合同累计已付款")])),_:1}),r(t,{class:"account-info-value"},{default:o((()=>[m(v(i(Q)(pa.value.contractAccumulatedPaid)||""),1)])),_:1})])),_:1}),r(l,{class:"account-info-row"},{default:o((()=>[r(t,{class:"account-info-label"},{default:o((()=>[m("专票金额(含税)")])),_:1}),r(t,{class:"account-info-value"},{default:o((()=>[m(v(i(Q)(pa.value.vatamount)||""),1)])),_:1})])),_:1}),r(l,{class:"account-info-row"},{default:o((()=>[r(t,{class:"account-info-label"},{default:o((()=>[m("可抵扣票据")])),_:1}),r(t,{class:"account-info-value"},{default:o((()=>[m(v(i(Q)(pa.value.invoiceAmountNet)||""),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):w("",!0)])),_:1})])),_:1}),r(l,{class:"section"},{default:o((()=>[r(l,{class:"section-title-2",onClick:e[2]||(e[2]=a=>da(i(F)))},{default:o((()=>[r(l,{class:"section-title-2-left"},{default:o((()=>[r(t,{class:"section-title-vertical"}),r(t,{class:"section-title-text"},{default:o((()=>[m("附件")])),_:1})])),_:1}),r(l,{class:b(["section-title-2-right",{active:ra(i(F))}])},null,8,["class"])])),_:1}),r(h,{name:"collapse"},{default:o((()=>[ra(i(F))?(d(),u(l,{key:0,class:"attachment-section"},{default:o((()=>[r(c,{list:Z.value},null,8,["list"])])),_:1})):w("",!0)])),_:1})])),_:1}),r(l,{class:"section"},{default:o((()=>[r(l,{class:"section-title-2",onClick:e[3]||(e[3]=a=>da(i(V)))},{default:o((()=>[r(l,{class:"section-title-2-left"},{default:o((()=>[r(t,{class:"section-title-vertical"}),r(t,{class:"section-title-text"},{default:o((()=>[m("审批记录")])),_:1})])),_:1}),r(l,{class:b(["section-title-2-right",{active:ra(i(V))}])},null,8,["class"])])),_:1}),r(h,{name:"collapse"},{default:o((()=>[ra(i(V))?(d(),u(l,{key:0,class:"approval-record-section"},{default:o((()=>[r(q,{list:i(oa)},null,8,["list"])])),_:1})):w("",!0)])),_:1})])),_:1})])),_:1}),r(R,{ref_key:"inputDialogRef",ref:aa,required:i(ea),title:i(la),placeholder:i(ta),onConfirm:i(sa),onCancel:i(ca)},null,8,["required","title","placeholder","onConfirm","onCancel"])])),_:1})}}},[["__scopeId","data-v-3f5757f8"]]);export{U as default};
